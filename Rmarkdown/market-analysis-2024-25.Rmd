---
title: "<b>Portugal Market Analysis</b>"
output: 
  flexdashboard::flex_dashboard:
    source_code: embed
    orientation: columns
    vertical_layout: fill
    theme: simplex
editor_options: 
  chunk_output_type: console
runtime: shiny
---
<!-- theme alternatives: "cerulean",  "journal", "readable", "simplex", "united", "yeti" -->

```{r SETUP, message=FALSE, include=FALSE}
#GENERAL CODE CHUNK SETUP
knitr::opts_chunk$set(echo = FALSE, message=FALSE)

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#PACKAGE INSTALLATION AND LOADING
#-the essential packages required to load the document are markdown, knitr, flexdashboard and pacman.
#-the following code checks for their installation, installing them if required, and proceeds
#-to install/load other necessary packages.

if(!require("markdown")) install.packages("markdown")
if(!require("knitr")) install.packages("knitr")
if(!require("flexdashboard")) install.packages("flexdashboard")
if(!require("pacman")) install.packages("pacman") 
#--pacman function essential for loading and installing (if not already installed) packages together

pacman::p_load(
  knitr,           #--essential for rmarkdown document modification
  tidyverse,       #--contains ggplot2, readr, tibble, dplyr, magrittr
  reactable,       #--for creation of large tables
  janitor,         #--manipulation, summarisation of messy data, plus duplicate detection
  inspectdf,       #--dataframe inspection, relative to value (used in dataset analysis)
  highcharter,     #--interactive data visualisation
  htmltools,       #--website page options (zoom, scrolling)
  collapsibleTree, #--for happiness factor collapsible tree
  broom,           #--needed to convert linear model for interpolation line into dataframe
  dygraphs,        #--package for time series model creation
  xts,             #--data format required by dygraphs
  shiny            #--"runtime: shiny" in JMAL header already loads the library, useful for debugging w/o knitting
)
```


```{r FUNCTIONS & DATA IMPORTING, message=FALSE, include=FALSE}
#FUNCTIONS
#-".csv" extension remover, for variable list
csv_remove <- 
  function(x){
    substr(x, 1, nchar(x)-4)
  }

#-----#

#-Highcharter() scatterplot format
scplot_custom <- function(x){ 
  x %>% 
    hc_title(style=list(
               fontWeight="bold",
               fontSize= "15px",
               fontFamily= "Lato"
              )
             ) %>% 
    hc_size(., width=80, height=310) %>% 
    hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>X: {point.x:.1f}%<br>Y: {point.y:.2f}") %>% 
    hc_yAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}/10"),
      lineColor="#ecf0f1") %>% 
    hc_xAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}%"), 
      lineColor="#ecf0f1") %>% 
    hc_plotOptions(., scatter=list(color="#db240c"))
  }

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#

#DATA IMPORTING
dsets <- list.files(path="./Datasets", pattern = "*.csv", full.names = FALSE)   #vector with file names

dsets <-
  #assign the value contained in each dataset to its respective name
  setNames(
    lapply(list.files(path= "./Datasets", pattern="*.csv", full.names = TRUE), read.csv), 
    #reading each csv file, same code as dsets w/ exception that it takes full file path rather than just the name
    lapply(dsets, csv_remove)
    #removing ".csv" file extension to create variable list, function above
  )

#final dsets vector contains variables associated w/ respective dataset:
#-global edits done to reduce variable names, since discarded data not required.
#-method flexible to increases, decreases or variations in order to dataset directory.
```

<!-- INTRODUCTION PAGE -->

# Introduction

<!-- DEFINITIONS SECTION -->

## Definitions and Graph {data-width="400"}

### **Definitions**


- What is a snack?
  - "A small meal or amount of food, usually eaten in a hurry" (definition from Oxford Dictionary)
- What types of snack exist?
  - Fruit Snacks (dried fruit, processed fruit snacks).
  - Snack Bars (cereal bars, protein/energy bars, fruit and nut bars, other snack bars).
  - Sweet Biscuits (chocolate coated biscuits, cookies, filled biscuits, plain biscuits, wafers).
- How do we outline the snack market?
  - Our market consists of the production and retail sales of dried fruit, processed fruit snacks,     cereal bars, energy bars, fruit and nut bars, other snack bars, chocolate coated biscuits,        cookies, filled biscuits, plain biscuits, wafers.
  - The market is valued according to retail selling price (RSP) and includes any applicable 
    taxes (definition from Euromonitor).

<!-- INDEX SECTION -->

### **Index**
```{r REPORT FACTOR WEB}
Index <- 
  data.frame(
    parent = c(rep("Socio-Demographic Analysis", 4), rep("Economic Analysis", 4), rep("Demand and              Supply", 3)),
    child = c("Population", "Health Factors", "Parallel with Italy and Spain", "Wealth                        Distribution", "General Economic Overview", "Snack Market", "Vieira de Castro & Filhos             Lda.", "Main Market Actors", "Supply and Demand Fluctuations", "Hypotheticals tied to             the good", "Effect of Externalities")
  )

collapsibleTree(Index, hierarchy = c("parent", "child"), collapsed = FALSE, 
                width = 600, height = NULL, tooltip = FALSE, fontSize= 10, fill= "#db240c")

```

<!-- ANALYSIS METHODS SECTION -->

## Analysis Methods {data-width="600"}

<!-- PREMISES TO INFERENCE SUBSECTION -->

###

####

##### **Premises to Inference**

The purpose of this section is to state the principles behind our statistical inference. In order to treat the data as objectively as possible, we followed a set of behaviours and procedures aimed at limiting bias and presenting information through useful, not deceiving representations.

The first necessity when analysing data dependent on multiple variables is to standardise it in function of a representative value. The main practices followed were:

-   filler
-   filler
-   filler

<!-- CHALLENGES FACED SUBSECTION -->

####

##### **Challenges Faced**

FILLER TEXT

<!-- CHALLENGES FACED SUBSECTION -->

####

##### **Overcoming Challenges**

FILLER TEXT

<!-- SOCIO-DEMOGRAPHICS PAGE -->

# Socio-Demographic Factors

<!-- POPULATION SECTION -->

## Population {.tabset .tabset-fade data-width="700"}

<!-- TAB 1 DEMOGRAPHICS -->

### **Demographic Data**

filler

<!-- TAB 2 HEALTH -->

### **Portuguese General Health**

filler

<!-- TAB 3 WEALTH -->

### **Wealth Distribution**

filler



















<!-- PARALLELS SECTION -->

## Parallels with Italy and Spain {data-width = "400"}

<!-- DEMOGRAPHICS GRAPHS -->

###

```{r}
2+2
```

<!-- HEALTH GRAPHS -->

###

```{r}
3+3
```

<!-- WEALTH GRAPHS -->

###

```{r}
4+4
```



