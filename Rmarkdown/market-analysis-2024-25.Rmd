---
title: "<b>Portugal Market Analysis</b>"
output: 
  flexdashboard::flex_dashboard:
    source_code: embed
    orientation: columns
    vertical_layout: fill
    theme: simplex
editor_options: 
  chunk_output_type: console
runtime: shiny
---
<!-- theme alternatives: "cerulean",  "journal", "readable", "simplex", "united", "yeti" -->

```{r SETUP, message=FALSE, include=FALSE}
#GENERAL CODE CHUNK SETUP
knitr::opts_chunk$set(echo = FALSE, message=FALSE)

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#PACKAGE INSTALLATION AND LOADING
#-the essential packages required to load the document are markdown, knitr, flexdashboard and pacman.
#-the following code checks for their installation, installing them if required, and proceeds
#-to install/load other necessary packages.

if(!require("markdown")) install.packages("markdown")
if(!require("knitr")) install.packages("knitr")
if(!require("flexdashboard")) install.packages("flexdashboard")
if(!require("pacman")) install.packages("pacman") 
#--pacman function essential for loading and installing (if not already installed) packages together

pacman::p_load(
  knitr,           #--essential for rmarkdown document modification
  tidyverse,       #--contains ggplot2, readr, tibble, dplyr, magrittr
  reactable,       #--for creation of large tables
  janitor,         #--manipulation, summarisation of messy data, plus duplicate detection
  inspectdf,       #--dataframe inspection, relative to value (used in dataset analysis)
  highcharter,     #--interactive data visualisation
  htmltools,       #--website page options (zoom, scrolling)
  collapsibleTree, #--for happiness factor collapsible tree
  broom,           #--needed to convert linear model for interpolation line into dataframe
  dygraphs,        #--package for time series model creation
  xts,             #--data format required by dygraphs
  shiny            #--"runtime: shiny" in JMAL header already loads the library, useful for debugging w/o knitting
)
```


```{r FUNCTIONS & DATA IMPORTING, message=FALSE, include=FALSE}
#FUNCTIONS
#-".csv" extension remover, for variable list
csv_remove <- 
  function(x){
    substr(x, 1, nchar(x)-4)
  }

#-----#

#-Highcharter() scatterplot format
scplot_custom <- function(x){ 
  x %>% 
    hc_title(style=list(
               fontWeight="bold",
               fontSize= "15px",
               fontFamily= "Lato"
              )
             ) %>% 
    hc_size(., width=80, height=310) %>% 
    hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>X: {point.x:.1f}%<br>Y: {point.y:.2f}") %>% 
    hc_yAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}/10"),
      lineColor="#ecf0f1") %>% 
    hc_xAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}%"), 
      lineColor="#ecf0f1") %>% 
    hc_plotOptions(., scatter=list(color="#db240c"))
  }

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#

#DATA IMPORTING
dsets <- list.files(path="./Datasets", pattern = "*.csv", full.names = FALSE)   #vector with file names

dsets <-
  #assign the value contained in each dataset to its respective name
  setNames(
    lapply(list.files(path= "./Datasets", pattern="*.csv", full.names = TRUE), read.csv), 
    #reading each csv file, same code as dsets w/ exception that it takes full file path rather than just the name
    lapply(dsets, csv_remove)
    #removing ".csv" file extension to create variable list, function above
  )

#final dsets vector contains variables associated w/ respective dataset:
#-global edits done to reduce variable names, since discarded data not required.
#-method flexible to increases, decreases or variations in order to dataset directory.
```



<!-- INTRODUCTION PAGE -->

# Introduction

<!-- DEFINITIONS SECTION -->

## Definitions and Graph {data-width="400"}

### **Research Question and Definitions**

Fruit Snacks, Snack Bars, Sweet Biscuits in Portugal and the strategy of *Vieira de Castro & Filhos Lda.* in that market.

- What is a snack?
  - "A small meal or amount of food, usually eaten in a hurry." (definition from Oxford Dictionary)
- What types of snack do we consider?
  - Fruit Snacks (dried fruit, processed fruit snacks).
  - Snack Bars (cereal bars, protein/energy bars, fruit and nut bars, other snack
  bars).
  - Sweet Biscuits (chocolate coated biscuits, cookies, filled biscuits, plain
  biscuits, wafers).
- How do we outline the snack market?
  - The Portuguese market consists of the production and retail sales of dried
  fruit, processed fruit snacks, cereal bars, energy bars, fruit and nut bars,
  other snack bars, chocolate coated biscuits, cookies, filled biscuits, plain
  biscuits, wafers.
  - The market is valued according to retail selling price (RSP) and includes any
  applicable taxes (definition from Euromonitor).

<!-- INDEX SECTION -->

### **Index**
```{r REPORT FACTOR WEB}
Index <- 
  data.frame(
    parent = c(rep("Socio-Demographic Analysis", 4), rep("Economic Analysis", 4),                rep("Demand and Supply", 3)),
    child = c("Population", "Health Factors", "Parallel with Italy and Spain",                  "Wealth Distribution", "General Economic Overview", "Snack Market",               "Vieira de Castro & Filhos Lda.", "Main Market Actors", "Supply and                Demand Fluctuations", "Hypotheticals tied to the good", "Effect of                Externalities")
  )

collapsibleTree(Index, hierarchy = c("parent", "child"), collapsed = FALSE, 
                width = 600, height = NULL, tooltip = FALSE, fontSize= 10, fill= "#db240c")

```

<!-- ANALYSIS METHODS SECTION -->

## Analysis Methods {data-width="600"}

<!-- PREMISES TO INFERENCE SUBSECTION -->

###

####

##### **Premises to Inference**

The purpose of this section is to state the principles behind our statistical inference. 
In order to treat the data as objectively as possible, specific behaviours and procedures 
were followed in regards to the making of the report. Our aim is limiting bias and
presenting information through useful representations.

In order to achieve reliable conclusions, we must conform to a rigid information 
selection process, in accordance with the following principles:

- Pertaining to quantitative information and assessing qualitative sources with
care.
- Thoroughly checking the validity, completeness and accessibility of the
information gathered online.
- Since our data is primarily secondary, we ensure that the external sources
  from which we collect data are reliable.
  - Information maily gathered from Eurostat (Passport data) and OurWorldinData.

Additionally, to avoid indirect manipulation of the data, much care was placed in
choosing the kinds of graphical representation added to the report. Moreso, our 
analysis was founded upon standardised values so as to guarantee truthful trends
acting in function of individual variables. 

<!-- CHALLENGES FACED SUBSECTION -->

####

##### **Challenges Faced**

Throughout the analysis, we incurred in a series of problems that complicated our
operations. It is to be expected that a research on a topic as expansive as a
market leads to fragmented conclusions or unsatisfactory outcomes. Some issues
faced were:

- Lack of public data for the company of study.
- Discordant data between sources.
- Lack of confidence in some data correlation.

<!-- OVERCOMING CHALLENGES SUBSECTION -->

####

##### **Overcoming Challenges**

To face the set of complications mentioned previously, our initial approach was 
to evaluate the quality of our available sources. A consideration we had to make
regarded using data with no adjacent studies, depriving us of the possibility of 
performing any kind of cross-analysis. Moreso, in situations where varied sources
would conflict, we would resort to addressing only the most reliable of those 
considered, following a form of hierarchy of information quality. The aforementioned 
order would peak with governmental-linked information, followed up by trustworthy 
data providers. In summary, we attempted to:

- Contact the company to obtain relevant information.
  - Resorting to a brand analysis for lack of response and of alternatives.
- Cross-referencing information sources.
- Attainment at a strict data evaluation hierarchy. 




<!-- SOCIO-DEMOGRAPHICS PAGE -->

# Socio-Demographic Factors

<!-- POPULATION SECTION -->

## Population {.tabset .tabset-fade data-width="550"}

<!-- TAB 1 DEMOGRAPHICS -->

### **Demographic Data**

filler

```{r PORTUGAL DEMOGRAPHICS}
5+5
```

<!-- TAB 2 HEALTH -->

### **Portuguese General Health**

filler

```{r PORTUGAL HEALTH}
7*2
```

<!-- TAB 3 WEALTH -->

### **Wealth Distribution**

filler

```{r PORTUGAL WEALTH}
6+6
```

<!-- PARALLELS SECTION -->

## Parallels with Italy and Spain {data-width = "450"}

###

filler

```{ShinyUI PORTUGAL SPAIN ITALY PARALLELS r}
2+2
```


