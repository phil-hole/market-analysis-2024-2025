---
title: "<b>Portugal Market Analysis</b>"
output: 
  flexdashboard::flex_dashboard:
    source_code: embed
    orientation: columns
    vertical_layout: fill
    theme: simplex
editor_options: 
  chunk_output_type: console
runtime: shiny
---
<!-- theme alternatives: "cerulean",  "journal", "readable", "simplex", "united", "yeti" -->

```{r SETUP, message=FALSE, include=FALSE}
#GENERAL CODE CHUNK SETUP
knitr::opts_chunk$set(echo = FALSE, message=FALSE)

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#PACKAGE INSTALLATION AND LOADING
#-the essential packages required to load the document are markdown, knitr, flexdashboard and pacman.
#-the following code checks for their installation, installing them if required, and proceeds
#-to install/load other necessary packages.

if(!require("markdown")) install.packages("markdown")
if(!require("knitr")) install.packages("knitr")
if(!require("flexdashboard")) install.packages("flexdashboard")
if(!require("pacman")) install.packages("pacman") 
#--pacman function essential for loading and installing (if not already installed) packages together

pacman::p_load(
  knitr,           #--essential for rmarkdown document modification
  tidyverse,       #--contains ggplot2, readr, tibble, dplyr, magrittr
  reactable,       #--for creation of large tables
  janitor,         #--manipulation, summarisation of messy data, plus duplicate detection
  inspectdf,       #--dataframe inspection, relative to value (used in dataset analysis)
  highcharter,     #--interactive data visualisation
  htmltools,       #--website page options (zoom, scrolling)
  collapsibleTree, #--for happiness factor collapsible tree
  broom,           #--needed to convert linear model for interpolation line into dataframe
  dygraphs,        #--package for time series model creation
  xts,             #--data format required by dygraphs
  shiny,           #--"runtime: shiny" in JMAL header already loads the library, useful for debugging w/o                       knitting
  shinyWidgets,    #--additional customisation for shiny elements
  readxl
)
```


```{r FUNCTIONS & DATA IMPORTING, message=FALSE, include=FALSE}
#FUNCTIONS
#-".csv" extension remover, for variable list
csv_remove <- 
  function(x){
    substr(x, 1, nchar(x)-4)
  }

#-----#

xls_remove <- 
  function(x){
    substr(x, 1, nchar(x)-5)
  }

#-----#

#HIGHCHARTER() SCATTERPLOT FORMAT
scplot_custom <- function(x){ 
  x %>% 
    hc_title(style=list(
               fontWeight="bold",
               fontSize= "15px",
               fontFamily= "Lato"
              )
             ) %>% 
    hc_size(., width=80, height=310) %>% 
    hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>X: {point.x:.1f}%<br>Y: {point.y:.2f}") %>% 
    hc_yAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}/10"),
      lineColor="#ecf0f1") %>% 
    hc_xAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}%"), 
      lineColor="#ecf0f1") %>% 
    hc_plotOptions(., scatter=list(color="#db240c"))
  }

#-----#

#HIGHCHARTER LINE CHART FORMAT
lnplot_custom <- function(x){
  x %>% 
    hc_title(style=list(
               fontWeight="bold",
               fontSize= "15px",
               fontFamily= "Lato"
              )
             ) %>% 
    hc_size(width = NULL, height = 350) %>% 
    hc_yAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}"),
      lineColor="#ecf0f1") %>%
    hc_xAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}"), 
      lineColor="#ecf0f1") %>% 
    hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>
          Year: {point.x:.f}<br>Population: {point.y:.f}") %>% 
    hc_plotOptions(.,line=list(color="#db240c"))

    
  
}

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#

#DATA IMPORTING
#when downloading the file, the working directory should automatically set to the path where the Markdown file is saved. if that does not occur, copy the Markdown from the dropdown menu between the "" and run the single line of code.
setwd("C:/Users/busop/All Files - ORIGINAL FILES OF DESKTOP LINKS/Github/market-analysis-2024-2025/Rmarkdown")

dsets <- list.files(path="./Datasets", pattern = "*.csv", full.names = FALSE)   #vector with file names

dsets <-
  #assign the value contained in each dataset to its respective name
  setNames(
    lapply(list.files(path= "./Datasets", pattern="*.csv", full.names = TRUE), read.csv), 
    #reading each csv file, same code as dsets w/ exception that it takes full file path rather than just the name
    lapply(dsets, csv_remove)
    #removing ".csv" file extension to create variable list, function above
  )

xls_dsets <- list.files(path="./Datasets", pattern = "*.xlsx", full.names = FALSE)   #vector with file names

xls_dsets <- 
  setNames(
    lapply(list.files(path="./Datasets", pattern = "*.xlsx", full.names = TRUE), read_excel),
    lapply(xls_dsets, xls_remove)
  )

#final dsets vector contains variables associated w/ respective dataset:
#-global edits done to reduce variable names, since discarded data not required.
#-method flexible to increases, decreases or variations in order to dataset directory.
```



<!-- INTRODUCTION PAGE -->

# Introduction

<!-- DEFINITIONS SECTION -->

## Definitions and Graph {data-width="450"}

### **Research Question and Definitions**

Fruit Snacks, Snack Bars, Sweet Biscuits in Portugal and the strategy of *Vieira de Castro & Filhos Lda.* in that market.

- What is a snack?
  - "A small meal or amount of food, usually eaten in a hurry." (definition from Oxford Dictionary)
- What types of snack do we consider?
  - Fruit Snacks (dried fruit, processed fruit snacks).
  - Snack Bars (cereal bars, protein/energy bars, fruit and nut bars, other snack
  bars).
  - Sweet Biscuits (chocolate coated biscuits, cookies, filled biscuits, plain
  biscuits, wafers).
- How do we outline the snack market?
  - The Portuguese market consists of the production and retail sales of dried
  fruit, processed fruit snacks, cereal bars, energy bars, fruit and nut bars,
  other snack bars, chocolate coated biscuits, cookies, filled biscuits, plain
  biscuits, wafers.
  - The market is valued according to retail selling price (RSP) and includes any
  applicable taxes (definition from Euromonitor).

<!-- INDEX SECTION -->

### **Index**
```{r REPORT FACTOR WEB}
Index <- 
  data.frame(
    parent = c(rep("Socio-Demographic Analysis", 4), rep("Economic Analysis", 4),                rep("Demand and Supply", 3)),
    child = c("Population", "Health Factors", "Parallel with Italy and Spain",                  "Portuguese Economy", "General Economic Overview", "Snack Market",               "Vieira de Castro & Filhos Lda.", "Main Market Actors", "Supply and                Demand Fluctuations", "Hypotheticals tied to the good", "Effect of                Externalities")
  )

collapsibleTree(Index, hierarchy = c("parent", "child"), collapsed = FALSE, 
                width = 600, height = NULL, tooltip = FALSE, fontSize= 10, fill= "#db240c")

```

<!-- ANALYSIS METHODS SECTION -->

## Analysis Methods {data-width="550"}

<!-- PREMISES TO INFERENCE SUBSECTION -->

###

####

##### **Premises to Inference**

The purpose of this section is to state the principles followed in the present statistical inference. 
In order to treat the data as objectively as possible, specific behaviours and procedures 
were followed in regards to the making of the report, with the aim of limiting bias and
presenting information through truthful representations.

In order to achieve reliable conclusions, a rigid information selection process was adhered to, in accordance with the following principles:

- Pertaining to quantitative information and assessing qualitative sources with
care.
- Thoroughly checking the validity, completeness and accessibility of the
information gathered online.
- Since the data employed is primarily secondary, ensuring that the external sources
  from which we collect data are reliable.
  - Information mainly gathered from Eurostat (Passport data) and OurWorldinData.

Additionally, to avoid indirect manipulation of the data, much care was placed in
choosing the kinds of graphical representations added to the report. Moreso, the 
analysis was founded upon standardised values so as to guarantee truthful trends
evolving coherently  to specified indexes. 

<!-- CHALLENGES FACED SUBSECTION -->

####

##### **Challenges Faced**

Throughout the analysis, a series of problems were incurred that complicated 
operations. It is to be expected that a research on a topic as expansive as a
market leads to fragmented conclusions or unsatisfactory outcomes. Some issues
faced were:

- Lack of public data for the company of study.
- Discordant data between sources.
- Lack of confidence in some data correlation.

<!-- OVERCOMING CHALLENGES SUBSECTION -->

####

##### **Overcoming Challenges**

To face the set of complications mentioned previously, the initial approach was 
to evaluate the quality of our available sources. A debatable consideration made
regarded using data with no adjacent studies, which lacked the possibility of 
performing any kind of cross-analysis. Additionally, in situations where varied sources
would conflict, the chosen solution was to address only the most reliable of those 
in contention, following a form of hierarchy of information quality. The aforementioned 
order would peak with governmental-linked information, followed up by trustworthy 
data providers. Generally speaking:

- Contacting the company to obtain relevant information.
  - Resorting to a brand analysis for lack of response and of alternatives.
- Cross-referencing information sources.
- Attaining at a strict data evaluation hierarchy. 



<!-- SOCIO-DEMOGRAPHICS PAGE -->

# Socio-Demographic Factors

<!-- POPULATION SECTION -->

## Population {.tabset .tabset-fade data-width="650"}

<!-- TAB 1 DEMOGRAPHICS -->

### **Demographic Data**

The primary element to consider when trying to understand Portuguese society is population. Data from the past 200 years shows an exponential demographic increase in the 20th century. This can be explained by a series of factors, namely a general betterment of living conditions in Europe following the industrial revolutions, with the gradual diffusion of better economic, social, political, educational and sanitary conditions in the modern world. Also important to mention is the period of general peace that followed the Second World War, as contexts offering stability and security favour demographic growth. 

Such a trend is mirrored by population density. Analysing this statistic in the same time span, a common fluctuating trend can be observed. In the second half of the 1960s though, a change in tendency is visible, and can be associated to a mass emigration following the rise of the Estado Novo dictatorship. 

In addition, a focus on immigration was provided to put into perspective the magnitude of foreigner influx into the nation. Regarding this point, a variation in trend occurs in concomitance with the 2008 global financial crisis, and can be explained by an adoption of more restrictive immigration policies in Portugal. 

<br>

```{r PORTUGAL DEMOGRAPHICS}
#CREATION OF CLEAN POPULATION, POPULATION DENSITY, LIFE EXPECTANCY, IMMIGRATION STOCK DATASETS
clean_population <- 
  dsets[["portugal_population"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal") %>% 
  select(-Code, -Entity) %>% 
  rename(`Population` = Population..historical.) %>% 
  hchart("line", hcaes(`Year`, `Population`)) %>% 
  hc_title(text = "Portuguese Population") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title=list(text="<b>Population [inhab]</b>", align="middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
          ) %>% 
  hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Population: {point.y:.f} inhab") %>% 
  hc_caption(
    text = "<b>Population</b> = number of inhabitants of a country, at any given year.",
    style = list(marginTop = "0px")
  )
  
  
clean_population_density <-
  dsets[["portugal_population_density"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Population Density` = Population.density) %>% 
  hchart("line", hcaes(`Year`, `Population Density`)) %>% 
  hc_title(text = "Portuguese Population Density") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title = list(text = "<b>Population Density [inhab/kmsq]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Population Density: {point.y:.1f} inhab/kmsq") %>% 
  hc_caption(
    text = "<b>Population Density</b> = population per square kilometer by country.",
    style = list(marginTop = "0px")
  )

clean_immigration <-
  dsets[["portugal_migrant_stock"]]%>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`International Immigrants` = Total.number.of.international.immigrants)%>% 
  hchart("line", hcaes(`Year`, `International Immigrants`)) %>% 
  hc_title(text = "Portuguese International Immigrants") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title = list(text = "<b>N° Immigrants [inhab]</b>", align = "middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
      ) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Immigrant Stock: {point.y:.f} inhab") %>% 
     hc_caption(
    text = "<b>International Immigration Stock</b> = people living in a given country who were born in another country, recorded at mid-year by age and sex and by region, country or area of destination.",
    style = list(marginTop = "0px")
  )

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC
pop_graph_choice <- c('Population', 'Population Density', 'International Immigrants')
pop_graph_code <- list(clean_population, clean_population_density, clean_immigration)

pop_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "pop_selection",
          label = "Demographics Graphs",
          choices = pop_graph_choice,
          selected = pop_graph_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        )
      ),
      
      mainPanel(
        width = 8,
        highchartOutput(outputId = "pop_highchart")
      ),
      
      position = c("left", "right")
    )
  })

pop_graph_server <- function(input, output){
  pop_selected <- reactive({
    pop_graph_code[pop_graph_choice %in% input$pop_selection]
  })
  
  output$pop_highchart <-
    renderHighchart({
      temp <- pop_selected() 
      temp[[1]]
    })
  }
      
shinyApp(ui = pop_graph_ui, server = pop_graph_server)
```

<!-- TAB 2 HEALTH -->

### **General Health**
Considering the nature of the market analysed and its tight relation to primary human needs, an overview of Portuguese general health is compulsory. 

The first and possibly most important value to take into account is life expectancy. It dramatically increases following the end of the Second World War, as to be expected, suffering small dips as part of a fluctuating growth. The most important takeaway from the relevant data is the presence of gradual yet quasi-constant increase, reducing in volatility with time. A plausible explanation could be the significant number of regulations implemented to improve health systems and national security, namely an efficient vaccination campaign pursued throughout the twentieth century. Together with a global betterment of living conditions, these efforts contributed to the rise of life expectancy. 

The other two datasets represented show respectively the average daily caloric supply available and the percentage of adults suffering from obesity in Portugal. The former presents a sharp divergence from an otherwise growing trend between the late 1970s and 1980s, which can be addressed as a byproduct of a series of economic and social factors, such as the inflationary crisis of the 1970s and growing waves of immigration from ex-African colonies. <br>
The latter instead, with its quasi-linear growth, can be analysed taking into consideration the former. Despite the average daily caloric supply varying wildly, the trend regarding food overconsumption, or obesity maintains a sharp growth rate, factor that could allow one to suppose a growing availability and consumption of calorie-intensive, economical foods, such as snacks. 
<br>

```{r PORTUGAL HEALTH}
clean_life_expectancy <-
  dsets[["portugal_life_expectancy"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Life Expectancy` = Period.life.expectancy.at.birth...Sex..all...Age..0) %>% 
  hchart("line", hcaes(`Year`, `Life Expectancy`)) %>% 
  hc_title(text = "Portuguese Life Expectancy") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title = list(text = "<b>Life Expectancy  [yrs]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Life Expectancy: {point.y:.1f} years") %>% 
   hc_caption(
    text = "<b>Life Expectancy</b> = metric that summarizes death rates across all age groups in one particular year.",
    style = list(marginTop = "0px")
  )

clean_calorie_supply <-
  dsets[["portugal_daily_caloric_supply"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Daily Calorie Supply` = Daily.calorie.supply.per.person) %>% 
  hchart("line", hcaes(`Year`, `Daily Calorie Supply`)) %>% 
  hc_title(text = "Portuguese Daily Calorie Supply") %>% 
  hc_yAxis(title = list(text = "<b>Average Daily Calorie Supply [kcal]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  lnplot_custom(.) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Average Daily Calorie Supply: {point.y:.1f} kcal") %>% 
  hc_caption(
    text = "<b>Per Capita Daily Calorie Supply</b> = amount of calories available to an average person, not   necessarily the calories actually consumed by that person.",
    style = list(marginTop = "0px")
  )
  
clean_obesity_rate <-
  dsets[["portugal_overweight_adults"]]%>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Overweight Share of Adults` =
           Prevalence.of.obesity.among.adults..BMI....30..crude.estimate........Sex..both.sexes...Age.group..18...years) %>% 
  hchart("line", hcaes(`Year`, `Overweight Share of Adults`)) %>% 
  hc_title(text = "Portuguese Obesity Rate") %>% 
  hc_yAxis(title = list(text = "<b>Obesity Rate [%]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  lnplot_custom(.) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Obesity Rate: {point.y:.1f}%") %>% 
  hc_caption(
    text = "<b>Obesity Rate</b> = percentage of adults aged 18+ years with a body mass index (BMI) of 30 kg/m2 or higher.",
    style = list(marginTop = "0px")
  )
  
#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC
health_graph_choice <- c('Life Expectancy', 'Daily Calorie Supply', 'Obesity Rate')
health_graph_code <- list(clean_life_expectancy, clean_calorie_supply, clean_obesity_rate)

health_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "health_selection",
          label = "Health Infographics",
          choices = health_graph_choice,
          selected = health_graph_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        )
      ),
      
      mainPanel(
        width = 8,
        highchartOutput(outputId = "health_highchart")
      ),
      
      position = c("left", "right")
    )
  })

health_graph_server <- function(input, output){
  health_selected <- reactive({
    health_graph_code[health_graph_choice %in% input$health_selection]
  })
  
  output$health_highchart <-
    renderHighchart({
      temp <- health_selected() 
      temp[[1]]
    })
  }
      
shinyApp(ui = health_graph_ui, server = health_graph_server)
```

<!-- TAB 3 WEALTH -->

### **Portuguese Economy**

The final topic to discuss when creating a general picture of Portugal is its economic situation. Having already been mentioned when discussing previous trends, a country’s economy is understandably ever-present in all societal sectors, more so in the functioning of any market, including the one of study.

In order to address how Portugal stands economic-wise, GDP per capita is a decent indicator of average wealth per individual, despite not taking into account wealth distribution. Generally, a growing trend can be observed, any sudden deviation from which occurs in concomitance with global economic crises, like the 2008 banking crisis and the 2020 Covid19 pandemic. Parallelly to the other representations, it signifies a general betterment of living conditions, as the average individual has more attainable wealth.
To compensate the superficiality of GDP per capita when it comes to many social factors contributing in addressing living standards, the notion of HDI was introduced, which formally expresses the aforementioned trend of growth through a summary indicator, without any significant variation in time. 

Finally, an important yet very recent statistic was included presenting the percentage of population below a fixed “poverty line”, or the ratio of individuals with a “monetary income (per equivalent adult) below EUR 7,095 euros (EUR 591 per month)”. A conclusion that can be drawn from this data is a general reduction of poverty following the introduction of the Euro and, as such, Portugal’s affinity with EU economic regulations. 


```{r PORTUGAL WEALTH}
#CLEAN GDP PRO CAPITA, HDI DATASETS
clean_gdp_capita <-
  dsets[["portugal_gdp_per_capita"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`GDP per capita` = GDP.per.capita..PPP..constant.2017.international...) %>% 
  hchart("line", hcaes(`Year`, `GDP per capita`)) %>% 
  lnplot_custom(.) %>% 
  hc_title(text = "Portuguese GDP per Capita") %>% 
  hc_yAxis(title = list(text = "<b>GDP per Capita [int $/inhab]</b>", align = "middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
           ) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>GDP per capita: {point.y:.f} $/inhab") %>% 
  hc_caption(
    text = "<b>GDP per Capita</b> = gross domestic product converted to international dollars using purchasing power parity rates, put into relation with population size.",
    style = list(marginTop = "0px")
  )

clean_hdi <-
  dsets[["portugal_hdi"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`HDI` = Human.Development.Index) %>% 
  hchart("line", hcaes(`Year`, `HDI`)) %>% 
  hc_title(text = "Portuguese Human Development Index") %>% 
  hc_yAxis(title = list(text = "<b>Human Development Index</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  lnplot_custom(.) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>HDI: {point.y:.f}") %>% 
  hc_caption(
    text = "<b>Human Development Index</b> = summary measure of key dimensions of human development (e.g. a long and healthy life, a good education, and a decent standard of living).",
    style = list(marginTop = "0px")
  )

clean_poverty_percentage <-
  dsets[["portugal_population_poverty"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Poverty Ratio` = Poverty.headcount.ratio.at.national.poverty.lines....of.population.) %>% 
  hchart("line", hcaes(`Year`, `Poverty Ratio`)) %>% 
  hc_title(text = "Portuguese Relative Population Poverty Percentage [%]") %>% 
  hc_yAxis(title = list(text = "<b>National Poverty Headcount Ratio</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  lnplot_custom(.) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Poverty Percentage: {point.y:.1f}%") %>% 
  hc_caption(
    text = "<b>National poverty headcount ratio</b> =  percentage of the population living below the national poverty line(s). <br>National estimates are based on population-weighted subgroup estimates from household surveys.",
    style = list(marginTop = "0px")
  )

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC
wealth_graph_choice <- c('GDP per Capita', 'Human Development Index', 'National Poverty Headcount Ratio')
wealth_graph_code <- list(clean_gdp_capita, clean_hdi, clean_poverty_percentage)

wealth_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "wealth_selection",
          label = "Economic Indicators",
          choices = wealth_graph_choice,
          selected = wealth_graph_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        )
      ),

      mainPanel(
        width = 8,
        highchartOutput(outputId = "wealth_highchart")
      ),

      position = c("left", "right")
    )
  })

wealth_graph_server <- function(input, output){
  wealth_selected <- reactive({
    wealth_graph_code[wealth_graph_choice %in% input$wealth_selection]
  })

  output$wealth_highchart <-
    renderHighchart({
      temp <- wealth_selected()
      temp[[1]]
    })
  }

shinyApp(ui = wealth_graph_ui, server = wealth_graph_server)
```

<!-- TAB 4 INTERPRETATION -->

### **Interpretation**

To favour the interpretation of data, it is necessary to highlight and subdivide Portuguese development into three distinct time periods, namely before 1970, between 1970 and 2014, from 2014 to the present day.
The first is characterised by an underdeveloped economy, with agriculture as its main factor, and low structural change attributable to low industrialisation of the corporate and the absence of a solid financial sector to sustain investment. 

The second presents an important historical event, the Carnation revolution of 1974, in which the governmental control of Portugal changed from the dictatorship of Estado Novo to a newly established, democratic government. This new inclusive institution favoured the structural development of Portugal, notably with an agrarian reform and its integration in the European Union. By accessing the EU single market, the country was able to extend its commercial reach and, through growing exports, gradually increase its capital endowment and begin catching up to other, more advanced member states.

The third and final subsection can be understood as a period of economic and social reforms, regulation that allowed Portugal to assert its position within the EU. The economy dramatically expanded to accommodate a growing tourism sector and a incremental demand for local goods, with both the government and the corporate sector undertaking financial investments locally and abroad to access new markets. 

Other important facts to mention are the implementation of careful immigration policies, the dramatic improvement of healthcare quality both in technology and in services, and the outlining of the Portuguese education system in Law 46/1986, which in their own way equally contributed to the trends observed in the previous representations.


<!-- PARALLELS SECTION -->

## Parallels{data-width = "450"}

### **Parallels with Italy and Spain** 



```{r PORTUGAL SPAIN ITALY PARALLELS}
#CLEAN PARALLELS DATASETS
pickerIp_choice <- c("Population Growth Rate", "Life Expectancy", "GDP per Capita")
radioBn_choice <- c("Portugal", "Italy", "Spain")

parallels_population <-
  dsets[["portugal_population_growth_rate"]] %>%
  filter(Year >= 1950 & Entity %in% radioBn_choice) %>%
  select(-Code) %>%
  rename(`Population` = Population.growth.rate)

parallels_life_expect <-
  dsets[["portugal_life_expectancy"]] %>%
  filter(Year >= 1950 & Entity %in% radioBn_choice) %>%
  select(-Code) %>%
  rename(`Life Expectancy` = Period.life.expectancy.at.birth...Sex..all...Age..0)

parallels_gdp <-
  dsets[["portugal_gdp_per_capita"]] %>%
  filter(Year >= 1800 & Entity %in% radioBn_choice) %>%
  select(-Code) %>%
  rename(`GDP per capita` = GDP.per.capita..PPP..constant.2017.international...)


parallels_graph_code <- list(parallels_population, parallels_life_expect, parallels_gdp)

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC

parallels_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "parallels_selection",
          label = "Comparison Factor",
          choices = pickerIp_choice,
          selected = pickerIp_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        ),
        radioButtons(inputId = "radioB_specifics",
               label = "Countries Compared",
               choices = radioBn_choice,
               selected = radioBn_choice[1])
      ),

      mainPanel(
        width = 8,
        highchartOutput(outputId = "parallels_highchart")
      ),

      position = c("left", "right")
    )
  })

parallels_graph_server <- function(input, output){
  parallels_topic_choice <- reactive({
    if(input$parallels_selection == pickerIp_choice[1]){
      parallels_graph_code[1]
    } else if(input$parallels_selection == pickerIp_choice[2]){
      parallels_graph_code[2]
    }else{
      parallels_graph_code[(length(parallels_graph_code))]
    }
  })
  
  parallels_scale <- reactive({
    if(input$parallels_selection == pickerIp_choice[1]){
      c(-3, 3)
    }else if(input$parallels_selection == pickerIp_choice[2]){
      c(40, 100)
    }else{
      c(5000, 50000)
    }
  })

  parallels_filtered_data <-
    reactive({
      temp <- parallels_topic_choice()
      temp <- temp[[1]]
      scale <- parallels_scale()

      if(input$parallels_selection == pickerIp_choice[1]){
        temp %>%
          filter(Entity %in% as.character(input$radioB_specifics)) %>%
          hchart("line", hcaes(`Year`, `Population`)) %>%
          hc_title(text = "Population Growth Rate Comparison") %>%
          hc_yAxis(title = list(text = "<b>Population Growth Rate [%]</b>", align = "middle")) %>%
          hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>%
          lnplot_custom(.) %>%
          hc_yAxis(min = scale[1], max = scale[2]) %>% 
          hc_tooltip(.,
           headerFormat = "",
           pointFormat =
             "<b>{point.name}</b><br>Year: {point.x:.f}<br>Growth Rate: {point.y:.2f}%") %>%
          hc_caption(
            text = "<b>Same scale comparison of Portugal's, Italy's and Spain's population growth rate.</b>",
            style = list(marginTop = "0px") 
          ) %>% 
          hc_plotOptions(
            line = list(zoneAxis = "x", 
                        zones = list(list(value = 2023, color = "#db240c"),
                                     list(color = "#db240c", dashStyle = "Dash")
                                     )
                       )
            )
      } else if(input$parallels_selection == pickerIp_choice[2]){
        temp %>%
          filter(Entity %in% as.character(input$radioB_specifics)) %>%
          hchart("line", hcaes(`Year`, `Life Expectancy`)) %>%
          hc_title(text = "Life Expectancy Comparison") %>%
          hc_yAxis(title = list(text = "<b>Life Expectancy [yrs]</b>", align = "middle")) %>%
          hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>%
          lnplot_custom(.) %>%
          hc_yAxis(min = scale[1], max = scale[2]) %>% 
          hc_tooltip(.,
           headerFormat = "",
           pointFormat =
             "<b>{point.name}</b><br>Year: {point.x:.f}<br>Life Expectancy: {point.y:.1f} years") %>%
          hc_caption(
            text = "<b>Same scale comparison of Portugal's, Italy's and Spain's life expectancy.</b>",
            style = list(marginTop = "0px")
          )      }
      else {
        temp %>%
          filter(Entity %in% as.character(input$radioB_specifics)) %>%
          hchart("line", hcaes(`Year`, `GDP per capita`)) %>%
          hc_title(text = "GDP per Capita Comparison") %>%
          hc_yAxis(title = list(text = "<b>GDP per Capita [int $/inhab]</b>", align = "middle")) %>%
          hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>%
          lnplot_custom(.) %>%
          hc_yAxis(min = scale[1], max = scale[2]) %>% 
          hc_tooltip(.,
           headerFormat = "",
           pointFormat =
             "<b>{point.name}</b><br>Year: {point.x:.f}<br>GDP per Capita: {point.y:.0f} $/inhab") %>%
          hc_caption(
            text = "<b>Same scale comparison of Portugal's, Italy's and Spain's GDP per capita.</b>",
            style = list(marginTop = "0px")
          )
      }
    })

  output$parallels_highchart <- renderHighchart({
    req(input$radioB_specifics)
    parallels_filtered_data()
  })

}

shinyApp(ui = parallels_graph_ui, server = parallels_graph_server)
```

<!-- ECONOMIC PAGE -->

# Economic Overview

<!-- SECTION 1 -->

## General Economic Overview

###


<br>

```{r ECONOMIC OVERVIEW}
#CLEAN PARALLELS DATASETS
economic_factor_choice <- 
  c("Nominal GDP", "Consumer Price Index", "Real GDP", "Real GDP Growth Rate", "Unemployment Rate", "Inflation Rate")

economics_nom_gdp <-
  dsets[["portugal_gdp_constant"]] %>% 
  filter(Entity == "Portugal") %>% 
  select(-Code, -Entity) %>% 
  rename(`Nominal GDP` = GDP..constant.2015.US..) 

economics_cpi <-
  dsets[["portugal_consumer_price_index"]] %>% 
  filter(Entity == "Portugal") %>% 
  select(-Code, -Entity) %>% 
  rename(`Consumer Price Index` = Consumer.price.index..2010...100.)
  

economics_rgdp <-
  merge(economics_nom_gdp, economics_cpi, by = "Year") %>% 
  mutate(`Real GDP` = (`Nominal GDP`/`Consumer Price Index`)*100) %>% 
  select(Year, `Real GDP`)

economics_rgdp_g_rate <-
  economics_rgdp %>% 
  mutate(`Real GDP Growth Rate` = ((`Real GDP` - lag(`Real GDP`)) / lag(`Real GDP`) * 100)) %>% 
  select(-`Real GDP`) %>% 
  hchart("line", hcaes(`Year`, `Real GDP Growth Rate`)) %>% 
  hc_title(text = "Portuguese Real GDP Growth Rate") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title=list(text="<b>Real GDP Growth Rate [%]</b>", align="middle")) %>% 
  hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Real GDP Growth Rate: {point.y:.1f}%"
  ) %>% 
  hc_caption(
    text = "<b>Real GDP Growth Rate</b> = growth rate of real GDP calculated year by year.",
    style = list(marginTop = "0px")
  )
  

economics_rgdp <-
  economics_rgdp %>%
  hchart("line", hcaes(`Year`, `Real GDP`)) %>% 
  hc_title(text = "Portuguese Real GDP") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title=list(text="<b>Real GDP [int $]</b>", align="middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000000) {
                            return (this.value/1000000000) + ' bil';
                          } else if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
          ) %>% 
  hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Real GDP: {point.y:,.0f} int $"
  ) %>% 
  hc_caption(
    text = "<b>Real GDP</b> = value expressing the amount of goods and services that are produced and sold through markets, at a given time, adjusted for constant prices using a deflator, the yearly consumer price index.",
    style = list(marginTop = "0px")
  )

economics_nom_gdp <-
  economics_nom_gdp %>% 
  hchart("line", hcaes(`Year`, `Nominal GDP`)) %>% 
  hc_title(text = "Portuguese Nominal GDP") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title=list(text="<b>Nominal GDP [int $]</b>", align="middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000000) {
                            return (this.value/1000000000) + ' bil';
                          } else if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
          ) %>% 
  hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Nominal GDP: {point.y:,.0f} int $") %>% 
  hc_caption(
    text = "<b>Nominal GDP</b> = value expressing the amount of goods and services that are produced and sold through markets, at a given time, calculated using current prices.",
    style = list(marginTop = "0px")
  )
  

economics_cpi <- 
  economics_cpi %>% 
  hchart("line", hcaes(`Year`, `Consumer Price Index`)) %>% 
  hc_title(text = "Portuguese Consumer Price Index") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title=list(text="<b>CPI</b>", align="middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000000) {
                            return (this.value/1000000000) + ' bil';
                          } else if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
          ) %>% 
  hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>CPI: {point.y:.2f}") %>% 
  hc_caption(
    text = "<b>Consumer Price Index</b> = average value of a basket containing the most largely used consumption goods and services.<br> Reference Year: 2010",
    style = list(marginTop = "0px")
  )

economics_unemployment <-
  dsets[["portugal_unemployment_rate"]] %>% 
  select(-Code) %>%
  filter(Entity == "Portugal") %>% 
  rename(`Unemployment Rate` = Unemployment..total....of.total.labor.force...modeled.ILO.estimate.) %>%
  hchart("line", hcaes(`Year`, `Unemployment Rate`)) %>%
  hc_title(text = "Portuguese Unemployment Rate") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title=list(text="<b>Unemployment Rate [%]</b>", align="middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
          ) %>% 
  hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Unemployment Rate: {point.y:.1f}%") %>% 
  hc_caption(
    text = "<b>Unemployment Rate</b> = percentage of the labour force that cannot find occupation within a short time span.",
    style = list(marginTop = "0px")
  )

economics_inflation <-
  dsets[["portugal_inflation"]] %>%
  select(-Code) %>% 
  filter(Entity == "Portugal") %>% 
  rename(`Inflation Rate`= Inflation..consumer.prices..annual...) %>%
  hchart("line", hcaes(`Year`, `Inflation Rate`)) %>%
  hc_title(text = "Portuguese Inflation Rate") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title=list(text="<b>Inflation Rate [%]</b>", align="middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
          ) %>% 
  hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Inflation Rate: {point.y:.1f}%") %>% 
  hc_caption(
    text = "<b>Inflation Rate</b> = rate of growth of a price index over time.",
    style = list(marginTop = "0px")
  )

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC
economics_graph_code <- list(economics_nom_gdp, economics_cpi, economics_rgdp, economics_rgdp_g_rate, economics_unemployment, economics_inflation)

economics_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "economics_selection",
          label = "General Economic Indicators",
          choices = economic_factor_choice,
          selected = economic_factor_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        )
      ),

      mainPanel(
        width = 8,
        highchartOutput(outputId = "economics_highchart")
      ),

      position = c("left", "right")
    )
  })

economics_graph_server <- function(input, output){
  selected <- reactive({
    economics_graph_code[economic_factor_choice %in% input$economics_selection]
  })

  output$economics_highchart <-
    renderHighchart({
      temp <- selected()
      temp[[1]]
    })
  }

shinyApp(ui = economics_graph_ui, server = economics_graph_server)
```

## Overview of the Snack Market

###
sitography:
https://www.geeksforgeeks.org/if-else-if-statement-in-r/

```{r}
# graph_ui <-
#   fluidPage({
#     sidebarLayout(
#       sidebarPanel(
#         width = 4,
#         pickerInput(
#           inputId = "selection",
#           label = "Population Graphs",
#           choices = graph_choice,
#           selected = graph_choice[1],
#           options = list(style = "btn-danger"),
#           width = "100%"
#         )
#       ),
#       
#       mainPanel(
#         width = 8,
#         highchartOutput(outputId = "highchart")
#       ),
#       
#       position = c("left", "right")
#     )
#   })
# 
# graph_server <- function(input, output){
#   selected <- reactive({
#     graph_code[graph_choice %in% input$selection]
#   })
#   
#   output$highchart <-
#     renderHighchart({
#       temp <- selected() 
#       temp[[1]]
#     })
#   }
#       
# shinyApp(ui = graph_ui, server = graph_server)
```












































# Graph Tester

## Graph Tester

```{r}
# pickerIp_choice <- c("Population", "Life Expectancy", "GDP per Capita")
# radioBn_choice <- c("Portugal", "Italy", "Spain")
# parallel_series_colours <- c("Portugal" = "#db240c", "Italy" = "#046A38", "Spain" = "#FFE900")
# 
# parallels_population <-
#   dsets[["portugal_population"]] %>% 
#   filter(Year >= 1950 & Entity %in% radioBn_choice) %>% 
#   select(-Code) %>% 
#   rename(`Value` = Population..historical.)
# 
# parallels_life_expect <-
#   dsets[["portugal_life_expectancy"]] %>% 
#   filter(Year >= 1950 & Entity %in% radioBn_choice) %>% 
#   select(-Code) %>% 
#   rename(`Value` = Period.life.expectancy.at.birth...Sex..all...Age..0)
# 
# parallels_gdp <-
#   dsets[["portugal_gdp_per_capita"]] %>% 
#   filter(Year >= 1800 & Entity %in% radioBn_choice) %>% 
#   select(-Code) %>% 
#   rename(`Value` = GDP.per.capita..PPP..constant.2017.international...)
#   
# 
# parallels_graph_code <- list(parallels_population, parallels_life_expect, parallels_gdp)
# 
# #+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
# #UI AND SERVER LOGIC
# 
# parallels_graph_ui <-
#   fluidPage({
#     sidebarLayout(
#       sidebarPanel(
#         width = 4,
#         pickerInput(
#           inputId = "parallels_selection",
#           label = "Comparison Factor",
#           choices = pickerIp_choice,
#           selected = pickerIp_choice[1],
#           options = list(style = "btn-danger"),
#           width = "100%"
#         ),
#         checkboxGroupInput(inputId = "radioB_specifics", 
#                label = "Countries Compared",
#                choices = radioBn_choice,
#                selected = radioBn_choice[1])
#       ),
# 
#       mainPanel(
#         width = 8,
#         highchartOutput(outputId = "parallels_highchart")
#       ),
# 
#       position = c("left", "right")
#     )
#   })
# 
# parallels_graph_server <- function(input, output){
#   parallels_topic_choice <- reactive({
#     if(input$parallels_selection == pickerIp_choice[1]){
#       parallels_graph_code[1]
#     } else if(input$parallels_selection == pickerIp_choice[2]){
#       parallels_graph_code[2]
#     }else{
#       parallels_graph_code[(length(parallels_graph_code))]
#     }
#   })
#   
#   parallels_nation_filter <-
#     reactive({
#       req(parallels_topic_choice(), input$radioB_specifics)
#       temp <- parallels_topic_choice()
#       temp <- temp[[1]] %>%
#         filter(Entity %in% as.character(input$radioB_specifics))
#     })
#   
#   output$parallels_highchart <- renderHighchart({
#     parallels_placeholder <- 
#       highchart() %>% 
#       hc_chart(type = "line")
#     
#     for(nation in input$radioB_specifics){
#       parallels_nation_filter() %>% 
#         filter(Entity == !!nation) %>% 
#         hc_add_series(parallels_placeholder,
#                       data = .,
#                       name = nation
#         )
#     }
#     
#     parallels_placeholder
#   })
#   
  # parallels_filtered_data <-
  #   reactive({
  #     req(input$parallels_selection)
  #     temp <- parallels_topic_choice()
  #     temp <- temp[[1]] %>% 
  #       filter(Entity %in% as.character(input$radioB_specifics))
  #     hc <- highchart()
  #     
  #     if(input$parallels_selection == pickerIp_choice[1]){
  #       hc %>% 
  #         hc_title(text = "Population Comparison") %>% 
  #         hc_yAxis(title = list(text = "<b>Population</b>", align = "middle")) %>% 
  #         hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  #         lnplot_custom(.) %>% 
  #         hc_tooltip(., 
  #          headerFormat = "",
  #          pointFormat = 
  #            "<b>{point.name}</b><br>Year: {point.x:.f}<br>Population: {point.y:.f} inhab") %>% 
  #         hc_caption(
  #           text = "<b>FILLER FOR NOW</b>"
  #         )
  #       
  #       for (nation in unique(temp$Entity)) {
  #         nation_data <- 
  #           temp %>% 
  #           filter(Entity == nation)
  #         hc <- hc %>%
  #           hc_add_series(
  #             data = nation_data,
  #             type = "line",
  #             hcaes(`Year`, `Population`),
  #             name = nation,
  #             color = parallel_series_colours[nation]
  #           )
  #       }
  #     }
  #     
  #     else if(input$parallels_selection == pickerIp_choice[2]){
  #       hc <-
  #         hc_title(text = "Life Expectancy Comparison") %>% 
  #         hc_yAxis(title = list(text = "<b>Life Expectancy</b>", align = "middle")) %>% 
  #         hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  #         lnplot_custom(.) %>% 
  #         hc_tooltip(., 
  #          headerFormat = "",
  #          pointFormat = 
  #            "<b>{point.name}</b><br>Year: {point.x:.f}<br>Life Expectancy: {point.y:.f} years") %>% 
  #         hc_caption(
  #           text = "<b>FILLER FOR NOW</b>"
  #         )
  #       
  #       for (nation in unique(temp$Entity)) {
  #         nation_data <- 
  #           temp %>% 
  #           filter(Entity == nation)
  #         hc <- hc %>%
  #           hc_add_series(
  #             data = nation_data,
  #             type = "line",
  #             hcaes(`Year`, `Life Expectancy`),
  #             name = nation,
  #             color = parallel_series_colours[nation]
  #           )
  #       }
  #     }
  #     else {
  #       hc <-
  #         hc_title(text = "GDP per Capita Comparison") %>% 
  #         hc_yAxis(title = list(text = "<b>GDP per Capita</b>", align = "middle")) %>% 
  #         hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  #         lnplot_custom(.) %>% 
  #         hc_tooltip(., 
  #          headerFormat = "",
  #          pointFormat = 
  #            "<b>{point.name}</b><br>Year: {point.x:.f}<br>GDP per Capita: {point.y:.f} $/inhab") %>% 
  #         hc_caption(
  #           text = "<b>FILLER FOR NOW</b>"
  #         )
  #       
  #       for (nation in unique(temp$Entity)) {
  #         nation_data <- 
  #           temp %>% 
  #           filter(Entity == nation)
  #         hc <- hc %>%
  #           hc_add_series(
  #             data = nation_data,
  #             type = "line",
  #             hcaes(`Year`, `GDP per capita`),
  #             name = nation,
  #             color = parallel_series_colours[nation]
  #           )
  #       }
  #     }
  #   })
  
  # output$parallels_highchart <- renderHighchart({
  #   parallels_filtered_data()
  # })

# }

# shinyApp(ui = parallels_graph_ui, server = parallels_graph_server)
```

