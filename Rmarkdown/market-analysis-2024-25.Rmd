---
title: "<b>Portugal Market Analysis</b>"
output: 
  flexdashboard::flex_dashboard:
    source_code: embed
    orientation: columns
    vertical_layout: fill
    theme: simplex
editor_options: 
  chunk_output_type: console
runtime: shiny
---
<!-- theme alternatives: "cerulean",  "journal", "readable", "simplex", "united", "yeti" -->

<style>
  body {
    text-align: justify;
    font-size: 15px;
  }
  h2 {
    font-size: 18px;
  }
</style>

```{r SETUP, message=FALSE, include=FALSE}
#GENERAL CODE CHUNK SETUP
knitr::opts_chunk$set(echo = FALSE, message=FALSE)

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#PACKAGE INSTALLATION AND LOADING
#-the essential packages required to load the document are markdown, knitr, flexdashboard and pacman.
#-the following code checks for their installation, installing them if required, and proceeds
#-to install/load other necessary packages.

if(!require("markdown")) install.packages("markdown")
if(!require("knitr")) install.packages("knitr")
if(!require("flexdashboard")) install.packages("flexdashboard")
if(!require("pacman")) install.packages("pacman") 
#--pacman function essential for loading and installing (if not already installed) packages together

pacman::p_load(
  knitr,           #--essential for rmarkdown document modification
  tidyverse,       #--contains ggplot2, readr, tibble, dplyr, magrittr
  reactable,       #--for creation of large tables
  janitor,         #--manipulation, summarisation of messy data, plus duplicate detection
  inspectdf,       #--dataframe inspection, relative to value (used in dataset analysis)
  highcharter,     #--interactive data visualisation
  htmltools,       #--website page options (zoom, scrolling)
  collapsibleTree, #--for happiness factor collapsible tree
  broom,           #--needed to convert linear model for interpolation line into dataframe
  dygraphs,        #--package for time series model creation
  xts,             #--data format required by dygraphs
  shiny,           #--"runtime: shiny" in JMAL header already loads the library, useful for debugging w/o                       knitting
  shinyWidgets,    #--additional customisation for shiny elements
  readxl,
  viridis
  )
```


```{r FUNCTIONS & DATA IMPORTING, message=FALSE, include=FALSE}
#FUNCTIONS
#-".csv" extension remover, for variable list
ext_remove <- 
  function(x){
    substr(x, 1, nchar(x)-4)
  }

xls_remove <-
  function(x){
    substr(x, 1, nchar(x)-5)
  }

#-----#

#HIGHCHARTER LINE CHART FORMAT
lnplot_custom <- function(x){
  x %>% 
    hc_title(style=list(
               fontWeight="bold",
               fontSize= "15px",
               fontFamily= "Lato"
              )
             ) %>% 
    hc_size(width = NULL, height = 350) %>% 
    hc_yAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}"),
      lineColor="#ecf0f1") %>%
    hc_xAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}"), 
      lineColor="#ecf0f1") %>% 
    hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>
          Year: {point.x:.f}<br>Population: {point.y:.f}") %>% 
    hc_plotOptions(.,line=list(color="#db240c")) 
}

#-----#

#HIGHCHARTER() BAR PLOT FORMAT
barplot_custom <- function(x){
  x %>% 
    hc_title(style=list(
               fontWeight="bold",
               fontSize= "15px",
               fontFamily= "Lato"
              )
             ) %>% 
    hc_size(width = NULL, height = 450) %>% 
    hc_yAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}"),
      lineColor="#ecf0f1") %>%
    hc_xAxis(
      type="linear",
      lineWidth=5,
      labels=list(format="{value}"), 
      lineColor="#ecf0f1") %>%
    hc_tooltip(shared = TRUE, crosshairs = TRUE, sort = TRUE) 
}
  
#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#

#DATA IMPORTING
#when downloading the file, the working directory should automatically set to the path where the Markdown file is saved. if that does not occur, copy the Markdown from the dropdown menu between the "" and run the single line of code.
setwd("C:/Users/busop/All Files - ORIGINAL FILES OF DESKTOP LINKS/Github/market-analysis-2024-2025/Rmarkdown")

dsets <- list.files(path="./Datasets", pattern = "*.csv", full.names = FALSE)   
#vector with file names

dsets <-
  #assign the value contained in each dataset to its respective name
  setNames(
    lapply(list.files(path= "./Datasets", pattern="*.csv", full.names = TRUE), read.csv), 
    #reading each csv file, same code as dsets w/ exception that it takes full file path rather than just the name
    lapply(dsets, ext_remove)
    #removing ".csv" file extension to create variable list, function above
  )

#same concept reapplied for xlsx files, useful to separate the two
xlsx_dsets <- list.files(path="./Datasets", pattern = "*.xlsx", full.names = TRUE)

xlsx_dsets <-
  setNames(
    lapply(xlsx_dsets, read_xlsx),
    lapply(list.files(path="./Datasets", pattern = "*.xlsx", full.names = FALSE), xls_remove)
  )

#final dsets vectors contains variables associated w/ respective dataset:
#-global edits done to reduce variable names, since discarded data not required.
#-method flexible to increases, decreases or variations in order to dataset directory.
```



<!-- INTRODUCTION PAGE -->

# Introduction

<!-- DEFINITIONS SECTION -->

## Definitions and Graph {data-width="450"}

### **Research Question and Definitions**

Fruit Snacks, Snack Bars, Sweet Biscuits in Portugal and the strategy of *Vieira de Castro & Filhos Lda.* in that market.

- What is a snack?
  - "A small meal or amount of food, usually eaten in a hurry." (Oxford Dictionary)
- What types of snack do we consider?
  - Fruit Snacks (dried fruit, processed fruit snacks).
  - Snack Bars (cereal bars, protein/energy bars, fruit and nut bars, other snack
  bars).
  - Sweet Biscuits (chocolate coated biscuits, cookies, filled biscuits, plain
  biscuits, wafers).
- How do we outline the snack market?
  - The market considered encloses the three categories above, including all their subcategories.
  - The market is valued according to retail selling price (RSP) and includes any
  applicable taxes (definition from Euromonitor).
  - Factors considered pertain to the subset specified, at most representing the general food manufacture       sector. 

<!-- INDEX SECTION -->

### **Index**
```{r REPORT FACTOR WEB}
Index <- 
  data.frame(
    parent = c(rep("Socio-Demographic Analysis", 4), rep("Economic Analysis", 4),                rep("Demand and Supply", 3)),
    child = c("Population", "Health Factors","Portuguese Economy", "Parallel with Italy and Spain", "General Economic Overview", "Snack Market","Vieira de Castro & Filhos Lda.", "Main Market Actors", "Supply and Demand Fluctuations", "Hypotheticals tied to the good", "Effect of Externalities")
  )

collapsibleTree(Index, hierarchy = c("parent", "child"), collapsed = FALSE, 
                width = 600, height = NULL, tooltip = FALSE, fontSize= 10, fill= "#db240c")

```

<!-- ANALYSIS METHODS SECTION -->

## Analysis Methods {data-width="550"}

<!-- PREMISES TO INFERENCE SUBSECTION -->

### **Premises to Inference**

In order to achieve reliable conclusions, a rigid information selection process was adhered to, in accordance with the following principles:

- Pertaining to quantitative information and assessing qualitative sources with
care.
- Thoroughly checking the validity, completeness and accessibility of the
information gathered online.
- Ensuring the reliability of the external, secondary sources used.
  - Information mainly gathered from Eurostat, Passport and OurWorldinData.
- Selecting truthful graphical representationos, avoiding indirect manipulation of data.
- Use of standardised values.

<!-- CHALLENGES FACED SUBSECTION -->

### **Challenges Faced**

Throughout the analysis, a series of problems were incurred that complicated 
operations. It is to be expected that a research on a topic as expansive as a
market leads to fragmented conclusions or unsatisfactory outcomes. Some issues
faced were:

- Lack of public data for the company of study.
- Discordant data between sources.
- Lack of confidence in some data correlation.

<!-- OVERCOMING CHALLENGES SUBSECTION -->

### **Overcoming Challenges**

To face the set of complications mentioned previously, the initial approach was 
to evaluate the quality of our available sources. 

- Creation of a hierarchy of source quality, peaking with governmental-linked information, followed up by       trustworthy data providers.
- Contacting data providers (e.g. Vieira itself) to obtain relevant information.
  - Resorting to a brand analysis for lack of response and of alternatives.
- Cross-referencing information sources.

<!-- SOCIO-DEMOGRAPHICS PAGE -->

# Socio-Demographic Factors

<!-- POPULATION SECTION -->

## Population {.tabset .tabset-fade data-width="650"}

<!-- TAB 1 DEMOGRAPHICS -->

### **Demographic Data**

**Population Growth**:

- Exponential demographic increase in Portugal during the 20th century.
- Influenced by improved living conditions in Europe after the Industrial Revolutions, including economic,      social, political, educational, and sanitary advancements.
- Post-WWII period of peace contributed to stability, fostering demographic growth.

**Population Density Trends**:

- Fluctuating trends observed over 200 years.
- Noticeable shift in the 1960s linked to mass emigration during the Estado Novo dictatorship.

**Immigration Dynamics**:

- Highlighted the significance of foreigner influx into Portugal.
- Trend variation after the 2008 global financial crisis due to more restrictive immigration policies.

<div style="height: 50px;"></div>

```{r PORTUGAL DEMOGRAPHICS}
#CREATION OF CLEAN POPULATION, POPULATION DENSITY, LIFE EXPECTANCY, IMMIGRATION STOCK DATASETS
clean_population <- 
  dsets[["portugal_population"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal") %>% 
  select(-Code, -Entity) %>% 
  rename(`Population` = Population..historical.) %>% 
  hchart("line", hcaes(`Year`, `Population`)) %>% 
  hc_title(text = "Portuguese Population") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title=list(text="<b>Population [inhab]</b>", align="middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
          ) %>% 
  hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Population: {point.y:.f} inhab") %>% 
  hc_caption(
    text = "<b>Population</b> = number of inhabitants of a country, at any given year.",
    style = list(marginTop = "0px")
  )
  
  
clean_population_density <-
  dsets[["portugal_population_density"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Population Density` = Population.density) %>% 
  hchart("line", hcaes(`Year`, `Population Density`)) %>% 
  hc_title(text = "Portuguese Population Density") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title = list(text = "<b>Population Density [inhab/kmsq]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Population Density: {point.y:.1f} inhab/kmsq") %>% 
  hc_caption(
    text = "<b>Population Density</b> = population per square kilometer by country.",
    style = list(marginTop = "0px")
  )

clean_immigration <-
  dsets[["portugal_migrant_stock"]]%>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`International Immigrants` = Total.number.of.international.immigrants)%>% 
  hchart("line", hcaes(`Year`, `International Immigrants`)) %>% 
  hc_title(text = "Portuguese International Immigrants") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title = list(text = "<b>N° Immigrants [inhab]</b>", align = "middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
      ) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Immigrant Stock: {point.y:.f} inhab") %>% 
     hc_caption(
    text = "<b>International Immigration Stock</b> = people living in a given country who were born in another country, recorded at mid-year by age and sex and by region, country or area of destination.",
    style = list(marginTop = "0px")
  )

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC
pop_graph_choice <- c('Population', 'Population Density', 'International Immigrants')
pop_graph_code <- list(clean_population, clean_population_density, clean_immigration)

pop_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "pop_selection",
          label = "Demographics Graphs",
          choices = pop_graph_choice,
          selected = pop_graph_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        )
      ),
      
      mainPanel(
        width = 8,
        highchartOutput(outputId = "pop_highchart")
      ),
      
      position = c("left", "right")
    )
  })

pop_graph_server <- function(input, output){
  pop_selected <- reactive({
    pop_graph_code[pop_graph_choice %in% input$pop_selection]
  })
  
  output$pop_highchart <-
    renderHighchart({
      temp <- pop_selected() 
      temp[[1]]
    })
  }
      
shinyApp(ui = pop_graph_ui, server = pop_graph_server)
```

<!-- TAB 2 HEALTH -->

### **General Health**
**Life Expectancy**:

- Dramatic increase post-WWII, marked by gradual, quasi-constant growth with reduced volatility over time.
- Improvements linked to health system regulations, vaccination campaigns, and better living conditions.

**Caloric Supply**:

- Average daily caloric supply mostly increased but diverged sharply in the late 1970s–1980s.
- This fluctuation likely due to economic/social disruptions, including the 1970s inflationary crisis and       immigration from former African colonies.

**Obesity Trends**:

- Obesity in Portugal shows a steady, linear growth.
- Despite fluctuations in caloric supply, obesity growth suggests increasing availability and consumption of    calorie-dense, economical foods, such as snacks.

<div style="height: 50px;"></div>

```{r PORTUGAL HEALTH}
clean_life_expectancy <-
  dsets[["portugal_life_expectancy"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Life Expectancy` = Period.life.expectancy.at.birth...Sex..all...Age..0) %>% 
  hchart("line", hcaes(`Year`, `Life Expectancy`)) %>% 
  hc_title(text = "Portuguese Life Expectancy") %>% 
  lnplot_custom(.) %>% 
  hc_yAxis(title = list(text = "<b>Life Expectancy  [yrs]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Life Expectancy: {point.y:.1f} years") %>% 
   hc_caption(
    text = "<b>Life Expectancy</b> = estimated time period an average individual (normalised by sex and age) is expected to live.",
    style = list(marginTop = "0px")
  )

clean_calorie_supply <-
  dsets[["portugal_daily_caloric_supply"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Daily Calorie Supply` = Daily.calorie.supply.per.person) %>% 
  hchart("line", hcaes(`Year`, `Daily Calorie Supply`)) %>% 
  hc_title(text = "Portuguese Daily Calorie Supply") %>% 
  hc_yAxis(title = list(text = "<b>Average Daily Calorie Supply [kcal]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  lnplot_custom(.) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Average Daily Calorie Supply: {point.y:.1f} kcal") %>% 
  hc_caption(
    text = "<b>Per Capita Daily Calorie Supply</b> = amount of calories available to an average person, not   necessarily the calories actually consumed by that person.",
    style = list(marginTop = "0px")
  )
  
clean_obesity_rate <-
  dsets[["portugal_overweight_adults"]]%>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Overweight Share of Adults` =
           Prevalence.of.obesity.among.adults..BMI....30..crude.estimate........Sex..both.sexes...Age.group..18...years) %>% 
  hchart("line", hcaes(`Year`, `Overweight Share of Adults`)) %>% 
  hc_title(text = "Portuguese Obesity Rate") %>% 
  hc_yAxis(title = list(text = "<b>Obesity Rate [%]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  lnplot_custom(.) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Obesity Rate: {point.y:.1f}%") %>% 
  hc_caption(
    text = "<b>Obesity Rate</b> = percentage of adults aged 18+ years with a body mass index (BMI) of 30 kg/m2 or higher.",
    style = list(marginTop = "0px")
  )
  
#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC
health_graph_choice <- c('Life Expectancy', 'Daily Calorie Supply', 'Obesity Rate')
health_graph_code <- list(clean_life_expectancy, clean_calorie_supply, clean_obesity_rate)

health_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "health_selection",
          label = "Health Infographics",
          choices = health_graph_choice,
          selected = health_graph_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        )
      ),
      
      mainPanel(
        width = 8,
        highchartOutput(outputId = "health_highchart")
      ),
      
      position = c("left", "right")
    )
  })

health_graph_server <- function(input, output){
  health_selected <- reactive({
    health_graph_code[health_graph_choice %in% input$health_selection]
  })
  
  output$health_highchart <-
    renderHighchart({
      temp <- health_selected() 
      temp[[1]]
    })
  }
      
shinyApp(ui = health_graph_ui, server = health_graph_server)
```

<!-- TAB 3 WEALTH -->

### **Portuguese Economy**

**GDP Per Capita**:

- Indicator of average wealth per individual, though it does not account for wealth distribution.
- Shows a general upward trend, with deviations during global crises (e.g., 2008 banking crisis, 2020 COVID-19   pandemic).
- Reflects improving living conditions and greater attainable wealth for individuals.

**Human Development Index (HDI**:

- Introduced to address GDP per capita's limitations in capturing broader social factors.
- Confirms the trend of gradual growth in living standards, with minimal time-based variation.

**Poverty Statistics**:

- Recent data highlights the percentage of the population below a fixed poverty line (**€7,095 annually or      €591 monthly**).
- Indicates a reduction in poverty post-Euro introduction, linked to Portugal's alignment with EU economic      regulations. 

<div style="height: 50px;"></div>

```{r PORTUGAL WEALTH}
#CLEAN GDP PRO CAPITA, HDI DATASETS
clean_gdp_capita <-
  dsets[["portugal_gdp_per_capita"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`GDP per capita` = GDP.per.capita..PPP..constant.2017.international...) %>% 
  hchart("line", hcaes(`Year`, `GDP per capita`)) %>% 
  lnplot_custom(.) %>% 
  hc_title(text = "Portuguese GDP per Capita") %>% 
  hc_yAxis(title = list(text = "<b>GDP per Capita [int $/inhab]</b>", align = "middle"),
           labels = list(
                      formatter = JS("function() {
                          if (this.value >= 1000000) {
                            return (this.value / 1000000) + ' mil';
                          } else if (this.value >= 1000) {
                            return (this.value / 1000) + ' k';
                          }
                          return this.value;
                        }")
                      )
           ) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>GDP per capita: {point.y:.f} $/inhab") %>% 
  hc_caption(
    text = "<b>GDP per Capita</b> = gross domestic product converted to international dollars using purchasing power parity rates, put into relation with population size.",
    style = list(marginTop = "0px")
  )

clean_hdi <-
  dsets[["portugal_hdi"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`HDI` = Human.Development.Index) %>% 
  hchart("line", hcaes(`Year`, `HDI`)) %>% 
  hc_title(text = "Portuguese Human Development Index") %>% 
  hc_yAxis(title = list(text = "<b>Human Development Index</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  lnplot_custom(.) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>HDI: {point.y:.f}") %>% 
  hc_caption(
    text = "<b>Human Development Index</b> = summary measure of key dimensions of human development (mean years of schooling, expected years of schooling, life expectancy at birth and gross national income per capita).",
    style = list(marginTop = "0px")
  )

clean_poverty_percentage <-
  dsets[["portugal_population_poverty"]] %>% 
  filter(Year >= 1800 & Entity == "Portugal" & Year <= 2023) %>% 
  select(-Code, -Entity) %>% 
  rename(`Poverty Ratio` = Poverty.headcount.ratio.at.national.poverty.lines....of.population.) %>% 
  hchart("line", hcaes(`Year`, `Poverty Ratio`)) %>% 
  hc_title(text = "Portuguese Relative Population Poverty Percentage [%]") %>% 
  hc_yAxis(title = list(text = "<b>National Poverty Headcount Ratio [%]</b>", align = "middle")) %>% 
  hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  lnplot_custom(.) %>% 
  hc_tooltip(., 
       headerFormat = "",
       pointFormat = 
         "<b>{point.name}</b><br>Year: {point.x:.f}<br>Poverty Percentage: {point.y:.1f}%") %>% 
  hc_caption(
    text = "<b>National poverty headcount ratio</b> =  percentage of the population living below the national poverty line(s) [591 € monthly income]. <br>National estimates are based on population-weighted subgroup estimates from household surveys.",
    style = list(marginTop = "0px")
  )

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC
wealth_graph_choice <- c('GDP per Capita', 'Human Development Index', 'National Poverty Headcount Ratio')
wealth_graph_code <- list(clean_gdp_capita, clean_hdi, clean_poverty_percentage)

wealth_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "wealth_selection",
          label = "Economic Indicators",
          choices = wealth_graph_choice,
          selected = wealth_graph_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        )
      ),

      mainPanel(
        width = 8,
        highchartOutput(outputId = "wealth_highchart")
      ),

      position = c("left", "right")
    )
  })

wealth_graph_server <- function(input, output){
  wealth_selected <- reactive({
    wealth_graph_code[wealth_graph_choice %in% input$wealth_selection]
  })

  output$wealth_highchart <-
    renderHighchart({
      temp <- wealth_selected()
      temp[[1]]
    })
  }

shinyApp(ui = wealth_graph_ui, server = wealth_graph_server)
```

<!-- TAB 4 INTERPRETATION -->

### **Interpretation**

**Interpretation**:

- Integrates demographic, sanitary, and economic data with historical and cultural context.
- Divides Portuguese development into three key time periods: pre-1970, 1970–2014, and post-2014.

**Pre-1970**:

- Economy dominated by agriculture and low industrialization.
- Lack of a developed financial sector to support investments.
- Characterized by underdevelopment and minimal structural change.

**1970–2014**:

- Marked by the Carnation Revolution (1974), transitioning Portugal from dictatorship (Estado Novo) to          democracy.
- Structural reforms included agrarian reform and EU integration.
- EU membership enabled access to the single market, boosting exports, increasing capital, and fostering        gradual economic convergence with more advanced EU states.

**Post-2014**:

- Period of economic and social reforms consolidating Portugal’s position within the EU.
- Expansion of tourism and growing demand for local goods.
- Significant financial investments by the government and corporate sectors to access new markets.

**Underlying Developments Across Periods**:

- Steady technological, social, and health improvements, including:
- Careful immigration policies.
- Advances in healthcare technology and services.
- Establishment of a formal education system (Law 46/1986).

<!-- PARALLELS SECTION -->

## Parallels{data-width = "450"}

### **Parallels with Italy and Spain** 



```{r PORTUGAL SPAIN ITALY PARALLELS}
#CLEAN PARALLELS DATASETS
pickerIp_choice <- c("Population Growth Rate", "Life Expectancy", "GDP per Capita")
radioBn_choice <- c("Portugal", "Italy", "Spain")

parallels_population <-
  dsets[["portugal_population_growth_rate"]] %>%
  filter(Year >= 1950 & Entity %in% radioBn_choice) %>%
  select(-Code) %>%
  rename(`Population` = Population.growth.rate)

parallels_life_expect <-
  dsets[["portugal_life_expectancy"]] %>%
  filter(Year >= 1950 & Entity %in% radioBn_choice) %>%
  select(-Code) %>%
  rename(`Life Expectancy` = Period.life.expectancy.at.birth...Sex..all...Age..0)

parallels_gdp <-
  dsets[["portugal_gdp_per_capita"]] %>%
  filter(Year >= 1800 & Entity %in% radioBn_choice) %>%
  select(-Code) %>%
  rename(`GDP per capita` = GDP.per.capita..PPP..constant.2017.international...)


parallels_graph_code <- list(parallels_population, parallels_life_expect, parallels_gdp)

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC

parallels_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = NULL,
        pickerInput(
          inputId = "parallels_selection",
          label = "Comparison Factor",
          choices = pickerIp_choice,
          selected = pickerIp_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        ),
        radioButtons(inputId = "radioB_specifics",
                     label = "Countries Compared",
                     choices = radioBn_choice,
                     selected = radioBn_choice[1])
      ),
      
      mainPanel(
        width = NULL,
        highchartOutput(outputId = "parallels_highchart")
      ),
      
      position = c("left", "right")
    )
  })

parallels_graph_server <- function(input, output){
  parallels_topic_choice <- reactive({
    if(input$parallels_selection == pickerIp_choice[1]){
      parallels_graph_code[1]
    } else if(input$parallels_selection == pickerIp_choice[2]){
      parallels_graph_code[2]
    }else{
      parallels_graph_code[(length(parallels_graph_code))]
    }
  })
  
  parallels_scale <- reactive({
    if(input$parallels_selection == pickerIp_choice[1]){
      c(-3, 3)
    }else if(input$parallels_selection == pickerIp_choice[2]){
      c(40, 100)
    }else{
      c(5000, 50000)
    }
  })
  
  parallels_filtered_data <-
    reactive({
      temp <- parallels_topic_choice()
      temp <- temp[[1]]
      scale <- parallels_scale()
      
      if(input$parallels_selection == pickerIp_choice[1]){
        temp %>%
          filter(Entity %in% as.character(input$radioB_specifics)) %>%
          hchart("line", hcaes(`Year`, `Population`)) %>%
          hc_title(text = "Population Growth Rate Comparison") %>%
          hc_yAxis(title = list(text = "<b>Population Growth Rate [%]</b>", align = "middle")) %>%
          hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>%
          lnplot_custom(.) %>%
          hc_yAxis(min = scale[1], max = scale[2]) %>% 
          hc_tooltip(.,
                     headerFormat = "",
                     pointFormat =
                       "<b>{point.name}</b><br>Year: {point.x:.f}<br>Growth Rate: {point.y:.2f}%") %>%
          hc_caption(
            text = "<b>Same scale comparison of Portugal's, Italy's and Spain's population growth rate.</b>",
            style = list(marginTop = "0px") 
          ) %>% 
          hc_plotOptions(
            line = list(zoneAxis = "x", 
                        zones = list(list(value = 2023, color = "#db240c"),
                                     list(color = "#db240c", dashStyle = "Dash")
                        )
            )
          )
      } else if(input$parallels_selection == pickerIp_choice[2]){
        temp %>%
          filter(Entity %in% as.character(input$radioB_specifics)) %>%
          hchart("line", hcaes(`Year`, `Life Expectancy`)) %>%
          hc_title(text = "Life Expectancy Comparison") %>%
          hc_yAxis(title = list(text = "<b>Life Expectancy [yrs]</b>", align = "middle")) %>%
          hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>%
          lnplot_custom(.) %>%
          hc_yAxis(min = scale[1], max = scale[2]) %>% 
          hc_tooltip(.,
                     headerFormat = "",
                     pointFormat =
                       "<b>{point.name}</b><br>Year: {point.x:.f}<br>Life Expectancy: {point.y:.1f} years") %>%
          hc_caption(
            text = "<b>Same scale comparison of Portugal's, Italy's and Spain's life expectancy.</b>",
            style = list(marginTop = "0px")
          )      }
      else {
        temp %>%
          filter(Entity %in% as.character(input$radioB_specifics)) %>%
          hchart("line", hcaes(`Year`, `GDP per capita`)) %>%
          hc_title(text = "GDP per Capita Comparison") %>%
          hc_yAxis(title = list(text = "<b>GDP per Capita [int $/inhab]</b>", align = "middle")) %>%
          hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>%
          lnplot_custom(.) %>%
          hc_yAxis(min = scale[1], max = scale[2]) %>% 
          hc_tooltip(.,
                     headerFormat = "",
                     pointFormat =
                       "<b>{point.name}</b><br>Year: {point.x:.f}<br>GDP per Capita: {point.y:.0f} $/inhab") %>%
          hc_caption(
            text = "<b>Same scale comparison of Portugal's, Italy's and Spain's GDP per capita.</b>",
            style = list(marginTop = "0px")
          )
      }
    })
  
  output$parallels_highchart <- renderHighchart({
    req(input$radioB_specifics)
    parallels_filtered_data()
  })
  
}

shinyApp(ui = parallels_graph_ui, server = parallels_graph_server)
```

<!-- ECONOMIC PAGE -->

# Economic Overview

<!-- SECTION 1 -->

## General Economic Overview - Graphs {data-width="425"}

###

```{r ECONOMIC OVERVIEW}
#CLEAN ECONOMICS DATASETS
economic_factor_choice <- 
  c("Real GDP", "Real GDP Growth Rate", "Unemployment Rate", "Inflation Rate")

economics_rgdp <-
  dsets[["portugal_real_gdp"]] %>% 
  rename(`Real GDP` = CLVMNACSCAB1GQPT, `Year` = DATE)

economics_rgdp_g_rate <-
  economics_rgdp %>% 
  mutate(`Real GDP Growth Rate` = ((`Real GDP` - lag(`Real GDP`)) / lag(`Real GDP`) * 100)) %>% 
  select(-`Real GDP`)

economics_unemployment <-
  dsets[["portugal_unemployment_rate"]] %>% 
  select(-Code) %>%
  filter(Entity == "Portugal") %>% 
  rename(`Unemployment Rate` = Unemployment..total....of.total.labor.force...modeled.ILO.estimate.)

economics_inflation <-
  dsets[["portugal_inflation"]] %>%
  select(-Code) %>%
  filter(Entity == "Portugal") %>%
  rename(`Inflation Rate`= Inflation..consumer.prices..annual...)

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#UI AND SERVER LOGIC
economics_graph_code <- list(economics_rgdp, economics_rgdp_g_rate, economics_unemployment, economics_inflation)

economics_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = 4,
        pickerInput(
          inputId = "economics_selection",
          label = "General Economic Indicators",
          choices = economic_factor_choice,
          selected = economic_factor_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        ),
        chooseSliderSkin("Flat", color = '#db240c'),
        sliderInput(inputId = "economics_year_slider",
                    label = "Year Interval",
                    min = 1990,
                    max = 2023,
                    value = c(1995, 2023),
                    step = 1,
                    sep = "",
                    dragRange = TRUE
                    )
      ),

      mainPanel(
        width = 8,
        highchartOutput(outputId = "economics_highchart")
      ),

      position = c("left", "right")
    )
  })

economics_graph_server <- function(input, output){
  economics_selected_graph <- reactive({
    economics_graph_code[economic_factor_choice %in% input$economics_selection]
  })
  
  economics_filtered_graph <- 
    reactive({
      temp <- economics_selected_graph()
      temp <- 
        temp[[1]] %>% 
        filter(Year >= input$economics_year_slider[1], Year <= input$economics_year_slider[2])
      
      if(input$economics_selection == economic_factor_choice[1]){
        temp %>% 
            hchart("line", hcaes(`Year`, `Real GDP`)) %>%
            hc_title(text = "Portuguese Real GDP") %>%
            lnplot_custom(.) %>%
            hc_yAxis(title=list(text="<b>Real GDP [int $]</b>", align="middle"),
                     labels = list(
                                formatter = JS("function() {
                                    if (this.value >= 0) {
                                      return (this.value/1000) + ' bil';
                                    }
                                  }")
                                )
                    ) %>%
            hc_xAxis(title=list(text="<b>Year [Quarters per Year]</b>", align="middle")) %>%
            hc_tooltip(.,
                 headerFormat = "",
                 pointFormat =
                   "<b>{point.name}</b><br>Real GDP: {point.y:,.0f} bil int $"
            ) %>%
            hc_caption(
              text = "<b>Real GDP</b> = value expressing the amount of goods and services that are produced and sold through markets, at a given time, adjusted for constant prices using a price deflator.",
              style = list(marginTop = "0px")
            )
      } else if(input$economics_selection == economic_factor_choice[2]){
        temp %>% 
            hchart("line", hcaes(`Year`, `Real GDP Growth Rate`)) %>%
            hc_title(text = "Portuguese Real GDP Growth Rate") %>%
            lnplot_custom(.) %>%
            hc_yAxis(title=list(text="<b>Real GDP Growth Rate [%]</b>", align="middle")) %>%
            hc_xAxis(title=list(text="<b>Year [Quarters per Year]</b>", align="middle")) %>%
            hc_tooltip(.,
                 headerFormat = "",
                 pointFormat =
                   "<b>{point.name}</b><br>Year: {point.x:.f}<br>Real GDP Growth Rate: {point.y:.1f}%"
            ) %>%
            hc_caption(
              text = "<b>Real GDP Growth Rate</b> = growth rate of real GDP calculated year by year.",
              style = list(marginTop = "0px")
            )
      } else if(input$economics_selection == economic_factor_choice[3]){
        temp %>% 
            hchart("line", hcaes(`Year`, `Unemployment Rate`)) %>%
            hc_title(text = "Portuguese Unemployment Rate") %>%
            lnplot_custom(.) %>%
            hc_yAxis(title=list(text="<b>Unemployment Rate [%]</b>", align="middle")) %>%
            hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
            hc_tooltip(.,
                 headerFormat = "",
                 pointFormat =
                   "<b>{point.name}</b><br>Year: {point.x:.f}<br>Unemployment Rate: {point.y:.1f}%") %>%
            hc_caption(
              text = "<b>Unemployment Rate</b> = percentage of the labour force that cannot find occupation within a short time span.",
              style = list(marginTop = "0px")
            )
      } else{
        temp %>% 
            hchart("line", hcaes(`Year`, `Inflation Rate`)) %>%
            hc_title(text = "Portuguese Inflation Rate") %>%
            lnplot_custom(.) %>%
            hc_yAxis(title=list(text="<b>Inflation Rate [%]</b>", align="middle")) %>%
            hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
            hc_tooltip(.,
                 headerFormat = "",
                 pointFormat =
                   "<b>{point.name}</b><br>Year: {point.x:.f}<br>Inflation Rate: {point.y:.1f}%") %>%
            hc_caption(
              text = "<b>Inflation Rate</b> = rate of growth of a price index over time.",
              style = list(marginTop = "0px")
            )
      }
    })
  output$economics_highchart <-
    renderHighchart({
      req(input$economics_selection, input$economics_year_slider)
      economics_filtered_graph()
    })
  }

shinyApp(ui = economics_graph_ui, server = economics_graph_server)
```

## General Economic Overview - Text

### **Real GDP and Real GDP Growth Rate**


- General upward trend indicates robust economic growth over time.
- Late 20th Century: Period of rapid expansion, likely driven by:
  - Industrialization.
  - Expansion of the tertiary (service) sector.
  - Integration into the EU.
- Current Era:
  - Stabilisation of growth rate.
- Periods of Stagnation/Contraction:
  - Linked to global external events such as the COVID-19 pandemic.
  
### **Unemployment Rate**

- Stable Trend (pre-2008): Unemployment rate consistently between 5% and 10%.
- Impact of the 2008-2014 Financial Crisis:
  - Unemployment surged to 16%, then returned to the 5%-10% range after the crisis.
- Global Pandemic Impact:
  - Unemployment saw a similar spike during the pandemic but later stabilized.
- Recent Trends (Post-2022):
  - Rapid rebound in labour participation, signaling recovery and growing confidence in the job market.
  - Increase in unemployment during recovery attributed to mismatches between labour demand and supply,         including skill gaps and regional disparities.

### **Inflation Rate**

- 1970s Stagflation:
  - Inflation spiked significantly during the global stagflation event of the 1970s, marked by high inflation   and unemployment.
- Post-1970s Stability:
  - Inflation remained relatively stable between 2% and 3% after the stagflation period, due to stabilizing     economic policies, especially within the Eurozone.
- Inflation between 2020-2022:
  - Influenced by the COVID-19 pandemic and geopolitical tensions (notably the Russo-Ukrainian conflict),       which caused supply chain disruptions and price fluctuations due to scarcity.



# Snack Supply

## Snack Supply - Graphs {data-width="575"}

### 

```{r SUPPLY GRAPHS, fig.height=10}
#CLEAN SUPPLY DATASETS
clean_volume_price <-
  xlsx_dsets[["portugal_retail_volume_price"]] %>% 
  select(-`Category`, -`Unit`, -`Current Constant P`)%>% 
  pivot_longer(
    cols = c(-Geography,  -`Data Type`), 
    names_to = "Year", # Create a Year column from column names
    values_to = "Value" # Place data values in the Value column
  ) %>% 
  pivot_wider(names_from = `Data Type`, values_from = Value) %>% 
  mutate(`Price/Volume` = `Retail Value RSP` / `Retail Volume (Tonnes)`)

clean_company_shares <-
  xlsx_dsets[["portugal_company_shares"]] %>%
  select(-Country, -Category, -Unit) %>%
  filter(complete.cases(.))

clean_enterprise_n <-
  xlsx_dsets[["portugal_dsets_estat"]] %>% 
  select(Year, `Enterprise Number`) %>% 
  filter(complete.cases(.)) %>% 
  mutate(Year = as.numeric(Year), `Enterprise Number` = as.numeric(`Enterprise Number`))

clean_employee_n <-
  xlsx_dsets[["portugal_dsets_estat"]] %>% 
  select(Year, `Persons Employed`) %>% 
  filter(complete.cases(.))
  
clean_val_added <-
  xlsx_dsets[["portugal_dsets_estat"]] %>% 
  select(Year, `Value Added Millions`) %>% 
  filter(complete.cases(.))

clean_op_surplus <-
  xlsx_dsets[["portugal_dsets_estat"]] %>% 
  select(Year, `Gross Operating Surplus Million Euro`) %>% 
  filter(complete.cases(.))

clean_wages <-
  xlsx_dsets[["portugal_dsets_estat"]] %>% 
  select(Year, `Wages and Salaries`) %>% 
  filter(complete.cases(.))

clean_investment <-
  xlsx_dsets[["portugal_dsets_estat"]] %>% 
  select(Year, `Investment Rate`) %>% 
  filter(complete.cases(.)) %>% 
  mutate(Year = as.numeric(Year), `Investment Rate` = as.numeric(`Investment Rate`))


  

#+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
#FILTER VECTORS
supply_graph_choice <- c("Volumes w.r.t Sale Revenue", "Active Enterprises", "N° Employees",
                         "Value Added in Production", "Gross Operating Surplus", 
                         "Cost of Labour",  "Investment Rate", "Market Composition")

supply_graph_code <- list(clean_volume_price, clean_enterprise_n, clean_employee_n,
                          clean_val_added, clean_op_surplus, 
                          clean_wages, clean_investment, clean_company_shares)

#UI AND SERVER LOGIC
supply_graph_ui <-
  fluidPage({
    sidebarLayout(
      sidebarPanel(
        width = NULL,
        pickerInput(
          inputId = "supply_selection",
          label = "Supply Graphs",
          choices = supply_graph_choice,
          selected = supply_graph_choice[1],
          options = list(style = "btn-danger"),
          width = "100%"
        ),
        uiOutput(outputId = "supply_plus_filter")
      ),
      
      mainPanel(
        width = NULL,
        highchartOutput(outputId = "supply_highchart")
      ),

      position = c("left", "right")
    )
  })



supply_graph_server <- function(input, output){
  supply_graph_selected <- reactive({
    supply_graph_code[supply_graph_choice %in% input$supply_selection]
  })
  
  output$supply_plus_filter <- renderUI({
    if(input$supply_selection == supply_graph_choice[1]){
        tagList(
          pickerInput(
          inputId = "volumes_country_selection",
            label = "Geographic Scale",
            choices = c("Portugal", "World"),
            selected = "Portugal",
            options = list(style = "btn-danger"),
            width = "100%"
          ),
          chooseSliderSkin("Flat", color = '#db240c'),
          sliderInput(inputId = "supply_volume_price_slider",
                      label = "Year Interval",
                      min = 2010,
                      max = 2024,
                      value = c(2010, 2024),
                      step = 1,
                      sep = "",
                      dragRange = TRUE
                      )
        )
    } else if(input$supply_selection == supply_graph_choice[2]){
        tagList(
          chooseSliderSkin("Flat", color = '#db240c'),
          sliderInput(inputId = "supply_enterprise_slider",
                      label = "Year Interval",
                      min = 2008,
                      max = 2022,
                      value = c(2008, 2022),
                      step = 1,
                      sep = "",
                      dragRange = TRUE
                      )
        )
    } else if(input$supply_selection == supply_graph_choice[3]){
        tagList(
          chooseSliderSkin("Flat", color = '#db240c'),
          sliderInput(inputId = "supply_employee_slider",
                      label = "Year Interval",
                      min = 2008,
                      max = 2022,
                      value = c(2008, 2022),
                      step = 1,
                      sep = "",
                      dragRange = TRUE
                      )
        )
    } else if(input$supply_selection == supply_graph_choice[4]){
        tagList(
          chooseSliderSkin("Flat", color = '#db240c'),
          sliderInput(inputId = "supply_val_added_slider",
                      label = "Year Interval",
                      min = 2008,
                      max = 2022,
                      value = c(2008, 2022),
                      step = 1,
                      sep = "",
                      dragRange = TRUE
                      )
        )
    } else if(input$supply_selection == supply_graph_choice[5]){
        tagList(
          chooseSliderSkin("Flat", color = '#db240c'),
          sliderInput(inputId = "supply_op_surplus_slider",
                      label = "Year Interval",
                      min = 2008,
                      max = 2022,
                      value = c(2008, 2022),
                      step = 1,
                      sep = "",
                      dragRange = TRUE
                      )
        )
    } else if(input$supply_selection == supply_graph_choice[6]){
        tagList(
          chooseSliderSkin("Flat", color = '#db240c'),
          sliderInput(inputId = "supply_wages_slider",
                      label = "Year Interval",
                      min = 2008,
                      max = 2020,
                      value = c(2008, 2020),
                      step = 1,
                      sep = "",
                      dragRange = TRUE
                      )
        )
    } else if(input$supply_selection == supply_graph_choice[7]){
        tagList(
          chooseSliderSkin("Flat", color = '#db240c'),
          sliderInput(inputId = "supply_investment_slider",
                      label = "Year Interval",
                      min = 2008,
                      max = 2020,
                      value = c(2008, 2020),
                      step = 1,
                      sep = "",
                      dragRange = TRUE
                      )
        )
    } else if(input$supply_selection == supply_graph_choice[8]){
        tagList(
            pickerInput(
            inputId = "company_share_selection",
              label = "Company Share Data",
              choices = c("Average Share Value", "Market Concentration"),
              selected = "Average Share Value",
              options = list(style = "btn-danger"),
              width = "100%"
            ),
            chooseSliderSkin("Flat", color = '#db240c'),
            sliderInput(inputId = "supply_company_index_slider",
                      label = "Company Interval - Decreasing Share Value",
                      min = 1,
                      max = 37,
                      value = c(1, 10),
                      step = 1,
                      sep = "",
                      dragRange = TRUE
                      )
        )
    } 
  })
    
    
  supply_filtered_graph <- reactive({
    temp <- supply_graph_selected()
    
    if(input$supply_selection == supply_graph_choice[1]){
      req(input$volumes_country_selection, input$supply_volume_price_slider)
      temp <-
        temp[[1]] %>% 
        filter(Geography == as.character(input$volumes_country_selection)) %>% 
        filter(Year >= input$supply_volume_price_slider[1], Year <= input$supply_volume_price_slider[2])
    } 
    else if(input$supply_selection == supply_graph_choice[2]){
      req(input$supply_enterprise_slider)
      temp <-
        temp[[1]] %>% 
        filter(Year >= input$supply_enterprise_slider[1], Year <= input$supply_enterprise_slider[2])
    }
    else if(input$supply_selection == supply_graph_choice[3]){
      req(input$supply_employee_slider)
      temp <-
        temp[[1]] %>% 
        filter(Year >= input$supply_employee_slider[1], Year <= input$supply_employee_slider[2])
    }
    else if(input$supply_selection == supply_graph_choice[4]){
      req(input$supply_val_added_slider)
      temp <-
        temp[[1]] %>% 
        filter(Year >= input$supply_val_added_slider[1], Year <= input$supply_val_added_slider[2])
    }
    else if(input$supply_selection == supply_graph_choice[5]){
      req(input$supply_op_surplus_slider)
      temp <-
        temp[[1]] %>% 
        filter(Year >= input$supply_op_surplus_slider[1], Year <= input$supply_op_surplus_slider[2])
    } 
    else if(input$supply_selection == supply_graph_choice[6]){
      req(input$supply_wages_slider)
      temp <-
        temp[[1]] %>% 
        filter(Year >= input$supply_wages_slider[1], Year <= input$supply_wages_slider[2])
    }
    else if(input$supply_selection == supply_graph_choice[7]){
      req(input$supply_investment_slider)
      temp <-
        temp[[1]] %>%
        filter(Year >= input$supply_investment_slider[1], Year <= input$supply_investment_slider[2])
    }
    else if(input$supply_selection == supply_graph_choice[8]){
      req(input$company_share_selection)
      if(input$company_share_selection == "Average Share Value"){
        req(input$supply_company_index_slider)  
        temp <-
            temp[[1]] %>% 
            slice(input$supply_company_index_slider[1]:input$supply_company_index_slider[2]) %>% 
            pivot_longer(cols = -Company,
                         names_to = "Year",
                         values_to = "Value"
                         ) %>% 
            filter(Value != "-") %>% 
            mutate(Year = as.numeric(Year), Value = as.numeric(Value)) %>%
            group_by(Year) %>%
            summarize(Mean_Value = mean(Value, na.rm = TRUE))
      } 
      else if(input$company_share_selection == "Market Concentration"){
        req(input$supply_company_index_slider)  
        temp <-
          temp[[1]] %>% 
          slice(input$supply_company_index_slider[1]:input$supply_company_index_slider[2]) %>% 
          pivot_longer(cols = -Company,
                       names_to = "Year",
                       values_to = "Value"
                       ) %>%
          filter(Value != "-", Company != "Total") %>%
          mutate(Year = as.numeric(Year), Value = as.numeric(Value)) %>%
          pivot_wider(names_from = Company, values_from = Value)
      } 
    }
  })
    
  output$supply_highchart <- renderHighchart({
    if(input$supply_selection == supply_graph_choice[1]){
      supply_filtered_graph() %>% 
        hchart("line", hcaes(`Retail Volume (Tonnes)`, `Price/Volume`, name= Year)) %>% 
        hc_title(text = "Average Price - Ratio between Sale Revenue and Production Volume") %>%
        lnplot_custom(.) %>%
        hc_yAxis(title=list(
                         text="<b>Average Price [€]</b>", 
                         align="middle"
                       ),
                 labels = list(
                            formatter = JS("function() {
                                if (this.value >= 0) {
                                  return (this.value) + ' €';
                                }
                              }")
                            )
                ) %>%
        hc_xAxis(title=list(text="<b>Snack Retail Volume [000 tonnes]</b>", align="middle"),
                 labels = list(
                            formatter = JS("function() {
                                if (this.value >= 0) {
                                  return (this.value) + 'k';
                                }
                              }")
                            )) %>%
        hc_tooltip(.,
             headerFormat = "",
             pointFormat =
               "<b>{point.name}</b><br>Average Price: {point.y:.1f} €<br>Retail Volume: {point.x:.f}k tonnes<br>Retail Value RSP: {point.Retail Value RSP:.1f} mil €"
             ) %>% 
        hc_caption(
          text = "<b>Retail Sale Revenue/Volumes</b> = relationship expressing the average price of snacks for a given year, total revenue divided by volumes sold at retail level.<br>Eurostat Codes: sbs_na_sca_r2; sbs_sc_ovw",
          style = list(marginTop = "0px")
        )
    } 
    else if(input$supply_selection == supply_graph_choice[2]){
      supply_filtered_graph() %>% 
        hchart("line", hcaes(Year, `Enterprise Number`)) %>% 
        hc_title(text = "Number of Enterprises") %>%
        lnplot_custom(.) %>% 
        hc_yAxis(title=list(
                         text="<b>N° Enterprises</b>", 
                         align="middle"
                       ),
                 labels = list(
                            formatter = JS("function() {
                                if (this.value >= 1000) {
                                  return (this.value/1000) + 'k';
                                } 
                              }")
                            )
                ) %>%
        hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
        hc_tooltip(.,
             headerFormat = "",
             pointFormat =
               "<b>{point.name}</b><br>Year: {point.x:.f}<br>N° Enterprises: {point.y:.f}"
             ) %>% 
        hc_caption(
          text = "<b>Active Enterprises</b> = number of enterprises active in the food manufacture market in a given year.<br>Eurostat Codes: sbs_na_sca_r2; sbs_sc_ovw",
          style = list(marginTop = "0px")
        )
    }
    else if(input$supply_selection == supply_graph_choice[3]){
      supply_filtered_graph() %>% 
        hchart("line", hcaes(Year, `Persons Employed`)) %>% 
        hc_title(text = "Number of Employees") %>%
        lnplot_custom(.) %>% 
        hc_yAxis(title=list(
                         text="<b>N° Employees</b>", 
                         align="middle"
                       ),
                 labels = list(
                            formatter = JS("function() {
                                if (this.value >= 1000) {
                                  return (this.value/1000) + 'k';
                                } 
                              }")
                            )
                ) %>%
        hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
        hc_tooltip(.,
             headerFormat = "",
             pointFormat =
               "<b>{point.name}</b><br>Year: {point.x:.f}<br>N° Employees: {point.y:.f}"
             ) %>% 
        hc_caption(
          text = "<b>N° Employees</b> = number of employees working for enterprises active in the food manufacture market in a given year.<br>Eurostat Codes: sbs_na_sca_r2; sbs_sc_ovw",
          style = list(marginTop = "0px")
        )
    }
    else if(input$supply_selection == supply_graph_choice[4]){
      supply_filtered_graph() %>% 
        hchart("line", hcaes(Year, `Value Added Millions`)) %>% 
        hc_title(text = "Value Added through Production [mil €]") %>%
        lnplot_custom(.) %>% 
        hc_yAxis(title=list(
                         text="<b>Value Added [mil €]</b>", 
                         align="middle"
                       ),
                 labels = list(
                            formatter = JS("function() {
                                if (this.value >= 0) {
                                  return (this.value) + ' mil €';
                                } else if (this.value >= 1000) {
                                  return (this.value/1000) + ' bil €'
                                }
                              }")
                            )
                ) %>%
        hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
        hc_tooltip(.,
             headerFormat = "",
             pointFormat =
               "<b>{point.name}</b><br>Year: {point.x:.f}<br>Value Added: {point.y:.f} mil €"
             ) %>% 
        hc_caption(
          text = "<b>Value Added through Production</b> = increase in value brought by a production process, quantifiable as the difference between its sale price and the cost of its relative production factors, across all enterprises for a given year.<br>Eurostat Codes: sbs_na_sca_r2; sbs_sc_ovw",
          style = list(marginTop = "0px")
        )
    }
    else if(input$supply_selection == supply_graph_choice[5]){
      supply_filtered_graph() %>% 
        hchart("line", hcaes(Year, `Gross Operating Surplus Million Euro`)) %>% 
        hc_title(text = "Gross Operating Surplus [mil €]") %>%
        lnplot_custom(.) %>% 
        hc_yAxis(title=list(
                         text="<b>Gross Operating Surplus [mil €]</b>", 
                         align="middle"
                       ),
                 labels = list(
                            formatter = JS("function() {
                                if (this.value >= 0) {
                                  return (this.value) + ' mil €';
                                } else if (this.value >= 1000) {
                                  return (this.value/1000) + ' bil €'
                                }
                              }")
                            )
                ) %>%
        hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
        hc_tooltip(.,
             headerFormat = "",
             pointFormat =
               "<b>{point.name}</b><br>Year: {point.x:.f}<br>Gross Operating Surplus: {point.y:.f} mil €"
             ) %>% 
        hc_caption(
          text = "<b>Gross Operating Surplus</b> = enterprise profit on goods and services produced considering labour costs, subset of total profits indicating the weight of the labour production factor across enterprises for a given year.<br>Eurostat Codes: sbs_na_sca_r2; sbs_sc_ovw",
          style = list(marginTop = "0px")
        )
    }
    else if(input$supply_selection == supply_graph_choice[6]){
      supply_filtered_graph() %>% 
        hchart("line", hcaes(Year, `Wages and Salaries`)) %>% 
        hc_title(text = "Aggregate Labour Cost [mil €]") %>%
        lnplot_custom(.) %>% 
        hc_yAxis(title=list(
                         text="<b>Aggregate Labour Cost [mil €]</b>", 
                         align="middle"
                       ),
                 labels = list(
                            formatter = JS("function() {
                                if (this.value >= 0) {
                                  return (this.value) + ' mil';
                                } else if (this.value >= 1000) {
                                  return (this.value/1000) + ' bil'
                                }
                              }")
                            )
                ) %>%
        hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
        hc_tooltip(.,
             headerFormat = "",
             pointFormat =
               "<b>{point.name}</b><br>Year: {point.x:.f}<br>Aggregate Labour Cost: {point.y:.f} mil €"
             ) %>% 
        hc_caption(
          text = "<b>Aggregate Labour Cost</b> = cost of labour, aggregate corporate expenditure in wages and salaries in a given year.<br>Eurostat Codes: sbs_na_sca_r2; sbs_sc_ovw",
          style = list(marginTop = "0px")
        )
    }
    else if(input$supply_selection == supply_graph_choice[7]){
      supply_filtered_graph() %>% 
        hchart(., "line", hcaes(x = Year, y = `Investment Rate`)) %>% 
        hc_title(text = "Investment Rate [%]") %>% 
        lnplot_custom(.) %>% 
        hc_yAxis(title=list(text="<b>Investment Rate [%]</b>", align="middle"),
                 labels = list(
                   formatter = JS("function() {
                     if (this.value) {
                         return (this.value) + '%';
                       }
                     }")
                  )
                 ) %>%  
        hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
        hc_tooltip(.,
             headerFormat = "",
             pointFormat =
               "<b>{point.name}</b><br>Year: {point.x:.f}<br>Investment Rate: {point.y:.f}%"
             ) %>%
        hc_caption(
          text = "<b>Investment Rate</b> = ratio between gross tangible investment to net value added, measure of conversion of investments into tangible profit, in the food manufacture sector for a given year.<br>Eurostat Codes: sbs_na_sca_r2; sbs_sc_ovw",
          style = list(marginTop = "0px")
        )
    }
    else if(input$supply_selection == supply_graph_choice[8]){
        if(input$company_share_selection == "Average Share Value"){
          supply_filtered_graph() %>% 
            hchart("line", hcaes(Year, Mean_Value)) %>%
            hc_title(text = "Average Share Value [%]") %>%
            lnplot_custom(.) %>% 
            hc_yAxis(title=list(
                             text="<b>Average Share Value [%]</b>", 
                             align="middle"
                           ),
                     labels = list(
                                formatter = JS("function() {
                                    if (this.value >= 1000) {
                                      return (this.value/1000) + 'k';
                                    } 
                                  }")
                                )
                    ) %>%
            hc_xAxis(title=list(text="<b>Year</b>", align="middle")) %>%
            hc_tooltip(.,
                 headerFormat = "",
                 pointFormat =
                   "<b>{point.name}</b><br>Year: {point.x:.f}<br>Average Share Value: {point.y:.1f}%"
                 ) %>% 
            hc_caption(
              text = "<b>N-Indexed Average Share Value</b> = average value of the first n companies' share, in terms of market size.<br>Share value expressed as percentage of total market value, indicator of relative wealth of n selected companies, in particular when n < 10.<br>Eurostat Codes: sbs_na_sca_r2; sbs_sc_ovw",
              style = list(marginTop = "0px")
            )
        } else if (input$company_share_selection == "Market Concentration"){
            temp <- supply_filtered_graph() 
            hc_data <- 
              lapply(
                names(temp)[-1], 
                function(company) {
                  list(name = company, data = as.numeric(temp[[company]]))
                }
              )
            highchart() %>%
              hc_chart(type = "column") %>%
              hc_title(text = "Market Concentration [%]") %>%
              hc_plotOptions(column = list(stacking = "normal")) %>%
              hc_add_series_list(hc_data) %>%
              barplot_custom(.) %>% 
              hc_xAxis(categories = temp$Year) %>%
              hc_yAxis(title = list(text = "<b>Aggregate Share Value [%]</b>", align = "middle"),
                       min = 0,
                       labels = list(
                                 formatter = JS("function() {
                                     if (this.value >= 0) {
                                       return (this.value) + '%';
                                     } 
                                   }")
                                )
                       ) %>%
              hc_colors(colorRampPalette(c("#db240c", "#046A38", "#FFE900"))(input$supply_company_index_slider[2])) %>% 
              hc_caption(
                text = "<b>N-Indexed Market Concentration</b> = sum of share value of the first n companies, share value expressed in terms of % of total market value.<br>Indicative of market concentration, the greater the value for small n, the more tendentially monopolistic the market.",
                style = list(marginTop = "0px"))
        }
    }
  })
} 

shinyApp(ui = supply_graph_ui, server = supply_graph_server)
```

## Supply Side - Text

### **Supply**

####

The analysis of the supply side of a market hinges on various, diverse factors that influence in their own proportion the extent of occurring transactions. In order to present the most general picture possible, the indicators considered address factors starkly distinct in nature, that all find foundation in the notion of average price, the quotient of market revenues and production volumes. The goal of this section is to offer hypotheses regarding variations to average price, drafted from a comprehensive overview of said factors’ marginal change within the same year. An important premise to state is that represented data regards more generally the food manufacturing sector as a whole rather than the snack market subset. 
A characteristic standing out in the Portuguese market is an expansive supply throughout the period of study, only deviating from this trend between 2016 and 2018. As observed in the relative graph, the average price of the good of study never goes beyond a minimum of €5,80 and a maximum of €6,80, with all yearly values settling between these two. <br>
The initial contraction of demand seen until 2012 coincides with a fall in active enterprises and in-sector employment, and could hypothetically be tied to the banking crisis occurring within the same time frame, link strengthened by the drop in labour cost, investment success rate and gross operating surplus. Important to note is the reduction in labour cost parallel to that in employment and gross operating surplus, indicating an increase in price in other production factors, namely raw materials. Despite increasing production costs, the sharp decrease in competition allowed for an adjustment process ending on a lower price yet higher supply.
A period of supply and demand expansion, proven by stable prices and increasing quantities, was followed up in 2016 by a sudden contraction of supply. The observed increase in average price allows to hypothesize a stable demand through this time. On the other hand, its counterpart experiences a variation difficult to justify, with measured volumes essentially returning to the prior year’s value. In terms of the aforementioned factors, the cost of labour had been growing since 2013, but not to such an extent that would confidently tie the two events together, especially considering its unvaried trend in later years, together with that of employment. The successive logical assumption would be analysing the cost of raw materials but, as proven by an increasing gross operating surplus, again creating a link between the two seems far-fetched. Moreso, an almost unvaried number of active enterprises and market concentration in the top ten companies, leaves no evident conclusion to be made. Nonetheless, comparing such data to the global scale shows that such a contraction is isolated to Portugal, and as such is most likely do to variations in national economic policy, possibly following new food manufacturing regulations. A factor pushing for this conclusion would be an observed local minimum in the investment success rate, demonstrating a diminishing confidence in local food manufacturing. <br>
Despite the sudden shift in trend mentioned earlier, Portuguese supply returns to its expanding trend up, maintaining it throughout the COVID19 pandemic until 2022, when a sudden price drop occurs. A purely hypothetical claim would be addressing it as a reaction to the end of national lockdowns and a shift in preference towards foods outside of retail sale. A more data-backed interpretation would consider the rise in active enterprise and in gross operating surplus and justify it as a general increase in the competitiveness of the food manufacturing sector, as proven by a decrease in average share value (in terms of % of market value). Other ties could be made linking the decrement in the cost of production factors to it, but due to a lack of data following 2022, they cannot be made with full confidence. <br>
Other defining characteristics that stood out in the analysis process and were deemed relevant regard the unvarying trend of market concentration, settling towards 30% for the first ten companies and around 23% for the first four. Other than communicating a stable leadership of the food manufacture sector, it is indicative of a tendentially oligarchic market, at least from a competition standpoint. 

# Snack Demand

## Demand

### **Demand**

####

filler
sitography:
https://www.geeksforgeeks.org/if-else-if-statement-in-r/

####

```{r}
3+3

# graph_ui <-
#   fluidPage({
#     sidebarLayout(
#       sidebarPanel(
#         width = 4,
#         pickerInput(
#           inputId = "selection",
#           label = "Population Graphs",
#           choices = graph_choice,
#           selected = graph_choice[1],
#           options = list(style = "btn-danger"),
#           width = "100%"
#         )
#       ),
# 
#       mainPanel(
#         width = 8,
#         highchartOutput(outputId = "highchart")
#       ),
# 
#       position = c("left", "right")
#     )
#   })
# 
# graph_server <- function(input, output){
#   selected <- reactive({
#     graph_code[graph_choice %in% input$selection]
#   })
#   
#   output$highchart <-
#     renderHighchart({
#       temp <- selected() 
#       temp[[1]]
#     })
#   }
#       
# shinyApp(ui = graph_ui, server = graph_server)
```








































# Graph Tester

## Graph Tester

```{r}

# pickerIp_choice <- c("Population", "Life Expectancy", "GDP per Capita")
# radioBn_choice <- c("Portugal", "Italy", "Spain")
# parallel_series_colours <- c("Portugal" = "#db240c", "Italy" = "#046A38", "Spain" = "#FFE900")
# 
# parallels_population <-
#   dsets[["portugal_population"]] %>% 
#   filter(Year >= 1950 & Entity %in% radioBn_choice) %>% 
#   select(-Code) %>% 
#   rename(`Value` = Population..historical.)
# 
# parallels_life_expect <-
#   dsets[["portugal_life_expectancy"]] %>% 
#   filter(Year >= 1950 & Entity %in% radioBn_choice) %>% 
#   select(-Code) %>% 
#   rename(`Value` = Period.life.expectancy.at.birth...Sex..all...Age..0)
# 
# parallels_gdp <-
#   dsets[["portugal_gdp_per_capita"]] %>% 
#   filter(Year >= 1800 & Entity %in% radioBn_choice) %>% 
#   select(-Code) %>% 
#   rename(`Value` = GDP.per.capita..PPP..constant.2017.international...)
#   
# 
# parallels_graph_code <- list(parallels_population, parallels_life_expect, parallels_gdp)
# 
# #+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-#
# #UI AND SERVER LOGIC
# 
# parallels_graph_ui <-
#   fluidPage({
#     sidebarLayout(
#       sidebarPanel(
#         width = 4,
#         pickerInput(
#           inputId = "parallels_selection",
#           label = "Comparison Factor",
#           choices = pickerIp_choice,
#           selected = pickerIp_choice[1],
#           options = list(style = "btn-danger"),
#           width = "100%"
#         ),
#         checkboxGroupInput(inputId = "radioB_specifics", 
#                label = "Countries Compared",
#                choices = radioBn_choice,
#                selected = radioBn_choice[1])
#       ),
# 
#       mainPanel(
#         width = 8,
#         highchartOutput(outputId = "parallels_highchart")
#       ),
# 
#       position = c("left", "right")
#     )
#   })
# 
# parallels_graph_server <- function(input, output){
#   parallels_topic_choice <- reactive({
#     if(input$parallels_selection == pickerIp_choice[1]){
#       parallels_graph_code[1]
#     } else if(input$parallels_selection == pickerIp_choice[2]){
#       parallels_graph_code[2]
#     }else{
#       parallels_graph_code[(length(parallels_graph_code))]
#     }
#   })
#   
#   parallels_nation_filter <-
#     reactive({
#       req(parallels_topic_choice(), input$radioB_specifics)
#       temp <- parallels_topic_choice()
#       temp <- temp[[1]] %>%
#         filter(Entity %in% as.character(input$radioB_specifics))
#     })
#   
#   output$parallels_highchart <- renderHighchart({
#     parallels_placeholder <- 
#       highchart() %>% 
#       hc_chart(type = "line")
#     
#     for(nation in input$radioB_specifics){
#       parallels_nation_filter() %>% 
#         filter(Entity == !!nation) %>% 
#         hc_add_series(parallels_placeholder,
#                       data = .,
#                       name = nation
#         )
#     }
#     
#     parallels_placeholder
#   })
#   
  # parallels_filtered_data <-
  #   reactive({
  #     req(input$parallels_selection)
  #     temp <- parallels_topic_choice()
  #     temp <- temp[[1]] %>% 
  #       filter(Entity %in% as.character(input$radioB_specifics))
  #     hc <- highchart()
  #     
  #     if(input$parallels_selection == pickerIp_choice[1]){
  #       hc %>% 
  #         hc_title(text = "Population Comparison") %>% 
  #         hc_yAxis(title = list(text = "<b>Population</b>", align = "middle")) %>% 
  #         hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  #         lnplot_custom(.) %>% 
  #         hc_tooltip(., 
  #          headerFormat = "",
  #          pointFormat = 
  #            "<b>{point.name}</b><br>Year: {point.x:.f}<br>Population: {point.y:.f} inhab") %>% 
  #         hc_caption(
  #           text = "<b>FILLER FOR NOW</b>"
  #         )
  #       
  #       for (nation in unique(temp$Entity)) {
  #         nation_data <- 
  #           temp %>% 
  #           filter(Entity == nation)
  #         hc <- hc %>%
  #           hc_add_series(
  #             data = nation_data,
  #             type = "line",
  #             hcaes(`Year`, `Population`),
  #             name = nation,
  #             color = parallel_series_colours[nation]
  #           )
  #       }
  #     }
  #     
  #     else if(input$parallels_selection == pickerIp_choice[2]){
  #       hc <-
  #         hc_title(text = "Life Expectancy Comparison") %>% 
  #         hc_yAxis(title = list(text = "<b>Life Expectancy</b>", align = "middle")) %>% 
  #         hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  #         lnplot_custom(.) %>% 
  #         hc_tooltip(., 
  #          headerFormat = "",
  #          pointFormat = 
  #            "<b>{point.name}</b><br>Year: {point.x:.f}<br>Life Expectancy: {point.y:.f} years") %>% 
  #         hc_caption(
  #           text = "<b>FILLER FOR NOW</b>"
  #         )
  #       
  #       for (nation in unique(temp$Entity)) {
  #         nation_data <- 
  #           temp %>% 
  #           filter(Entity == nation)
  #         hc <- hc %>%
  #           hc_add_series(
  #             data = nation_data,
  #             type = "line",
  #             hcaes(`Year`, `Life Expectancy`),
  #             name = nation,
  #             color = parallel_series_colours[nation]
  #           )
  #       }
  #     }
  #     else {
  #       hc <-
  #         hc_title(text = "GDP per Capita Comparison") %>% 
  #         hc_yAxis(title = list(text = "<b>GDP per Capita</b>", align = "middle")) %>% 
  #         hc_xAxis(title = list(text = "<b>Year</b>", align = "middle")) %>% 
  #         lnplot_custom(.) %>% 
  #         hc_tooltip(., 
  #          headerFormat = "",
  #          pointFormat = 
  #            "<b>{point.name}</b><br>Year: {point.x:.f}<br>GDP per Capita: {point.y:.f} $/inhab") %>% 
  #         hc_caption(
  #           text = "<b>FILLER FOR NOW</b>"
  #         )
  #       
  #       for (nation in unique(temp$Entity)) {
  #         nation_data <- 
  #           temp %>% 
  #           filter(Entity == nation)
  #         hc <- hc %>%
  #           hc_add_series(
  #             data = nation_data,
  #             type = "line",
  #             hcaes(`Year`, `GDP per capita`),
  #             name = nation,
  #             color = parallel_series_colours[nation]
  #           )
  #       }
  #     }
  #   })
  
  # output$parallels_highchart <- renderHighchart({
  #   parallels_filtered_data()
  # })

# }

# shinyApp(ui = parallels_graph_ui, server = parallels_graph_server)
```

